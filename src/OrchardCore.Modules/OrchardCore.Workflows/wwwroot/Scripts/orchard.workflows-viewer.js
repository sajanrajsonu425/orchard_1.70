/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

///<reference path='../Lib/jquery/typings.d.ts' />
///<reference path='../Lib/jsplumb/typings.d.ts' />
///<reference path='./workflow-models.ts' />
var WorkflowCanvas = /** @class */function () {
  function WorkflowCanvas(container, workflowType) {
    var _this = this;
    this.container = container;
    this.workflowType = workflowType;
    this.minCanvasHeight = 400;
    this.getActivityElements = function () {
      return $(_this.container).find('.activity');
    };
    this.getDefaults = function () {
      return {
        Anchor: "Continuous",
        DragOptions: {
          cursor: 'pointer',
          zIndex: 2000
        },
        EndpointStyles: [{
          fillStyle: '#225588'
        }],
        Endpoints: [["Dot", {
          radius: 7
        }], ["Blank"]],
        ConnectionOverlays: [["Arrow", {
          width: 12,
          length: 12,
          location: -5
        }]],
        ConnectorZIndex: 5
      };
    };
    this.createJsPlumbInstance = function () {
      return jsPlumb.getInstance({
        DragOptions: {
          cursor: 'pointer',
          zIndex: 2000
        },
        ConnectionOverlays: [['Arrow', {
          location: 1,
          visible: true,
          width: 11,
          length: 11
        }], ['Label', {
          location: 0.5,
          id: 'label',
          cssClass: 'connection-label'
        }]],
        Container: _this.container
      });
    };
    this.getEndpointColor = function (activity) {
      return activity.isBlocking || activity.isStart ? '#7ab02c' : activity.isEvent ? '#3a8acd' : '#7ab02c';
    };
    this.getSourceEndpointOptions = function (activity, outcome) {
      // The definition of source endpoints.
      var paintColor = _this.getEndpointColor(activity);
      return {
        endpoint: 'Dot',
        anchor: 'Continuous',
        paintStyle: {
          stroke: paintColor,
          fill: paintColor,
          radius: 7,
          strokeWidth: 1
        },
        isSource: true,
        connector: ['Flowchart', {
          stub: [40, 60],
          gap: 0,
          cornerRadius: 5,
          alwaysRespectStubs: true
        }],
        connectorStyle: {
          strokeWidth: 2,
          stroke: '#999999',
          joinstyle: 'round',
          outlineStroke: 'white',
          outlineWidth: 2
        },
        hoverPaintStyle: {
          fill: '#216477',
          stroke: '#216477'
        },
        connectorHoverStyle: {
          strokeWidth: 3,
          stroke: '#216477',
          outlineWidth: 5,
          outlineStroke: 'white'
        },
        connectorOverlays: [['Label', {
          location: [3, -1.5],
          cssClass: 'endpointSourceLabel'
        }]],
        dragOptions: {},
        uuid: "".concat(activity.id, "-").concat(outcome.name),
        parameters: {
          outcome: outcome
        }
      };
    };
    this.getActivity = function (id, activities) {
      if (activities === void 0) {
        activities = null;
      }
      if (!activities) {
        activities = this.workflowType.activities;
      }
      return $.grep(activities, function (x) {
        return x.id === id;
      })[0];
    };
    this.updateConnections = function (plumber) {
      var workflowId = _this.workflowType.id;
      // Connect activities.
      for (var _i = 0, _a = _this.workflowType.transitions; _i < _a.length; _i++) {
        var transitionModel = _a[_i];
        var sourceEndpointUuid = "".concat(transitionModel.sourceActivityId, "-").concat(transitionModel.sourceOutcomeName);
        var sourceEndpoint = plumber.getEndpoint(sourceEndpointUuid);
        var destinationElementId = "activity-".concat(workflowId, "-").concat(transitionModel.destinationActivityId);
        plumber.connect({
          source: sourceEndpoint,
          target: destinationElementId
        });
      }
    };
    this.updateCanvasHeight = function () {
      var $container = $(this.container);
      // Get the activity element with the highest Y coordinate.
      var $activityElements = $container.find(".activity");
      var currentElementTop = 0;
      var currentActivityHeight = 0;
      for (var _i = 0, _a = $activityElements.toArray(); _i < _a.length; _i++) {
        var activityElement = _a[_i];
        var $activityElement = $(activityElement);
        var top_1 = $activityElement.position().top;
        if (top_1 > currentElementTop) {
          currentElementTop = top_1;
          currentActivityHeight = $activityElement.height();
        }
      }
      var newCanvasHeight = currentElementTop + currentActivityHeight;
      var elementBottom = currentElementTop + currentActivityHeight;
      var stretchValue = 100;
      if (newCanvasHeight - elementBottom <= stretchValue) {
        newCanvasHeight += stretchValue;
      }
      $container.height(Math.max(this.minCanvasHeight, newCanvasHeight));
    };
  }
  return WorkflowCanvas;
}();
///<reference path='../Lib/jquery/typings.d.ts' />
///<reference path='../Lib/jsplumb/typings.d.ts' />
///<reference path='./workflow-models.ts' />
///<reference path='./workflow-canvas.ts' />
var __extends = this && this.__extends || function () {
  var _extendStatics = function extendStatics(d, b) {
    _extendStatics = Object.setPrototypeOf || {
      __proto__: []
    } instanceof Array && function (d, b) {
      d.__proto__ = b;
    } || function (d, b) {
      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];
    };
    return _extendStatics(d, b);
  };
  return function (d, b) {
    if (typeof b !== "function" && b !== null) throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
    _extendStatics(d, b);
    function __() {
      this.constructor = d;
    }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
  };
}();
var WorkflowViewer = /** @class */function (_super) {
  __extends(WorkflowViewer, _super);
  function WorkflowViewer(container, workflowType) {
    var _this = _super.call(this, container, workflowType) || this;
    _this.container = container;
    _this.workflowType = workflowType;
    _this.getEndpointColor = function (activity) {
      return activity.isBlocking ? '#7ab02c' : activity.isEvent ? '#3a8acd' : '#7ab02c';
    };
    var self = _this;
    jsPlumb.ready(function () {
      jsPlumb.importDefaults(_this.getDefaults());
      var plumber = _this.createJsPlumbInstance();
      // Listen for new connections.
      plumber.bind('connection', function (connInfo, originalEvent) {
        var connection = connInfo.connection;
        var outcome = connection.getParameters().outcome;
        var label = connection.getOverlay('label');
        label.setLabel(outcome.displayName);
      });
      var activityElements = _this.getActivityElements();
      var areEqualOutcomes = function areEqualOutcomes(outcomes1, outcomes2) {
        if (outcomes1.length != outcomes2.length) {
          return false;
        }
        for (var i = 0; i < outcomes1.length; i++) {
          var outcome1 = outcomes1[i];
          var outcome2 = outcomes2[i];
          if (outcome1.name != outcome2.displayName || outcome1.displayName != outcome2.displayName) {
            return false;
          }
        }
        return true;
      };
      // Suspend drawing and initialize.
      plumber.batch(function () {
        var workflowId = _this.workflowType.id;
        activityElements.each(function (index, activityElement) {
          var $activityElement = $(activityElement);
          var activityId = $activityElement.data('activity-id');
          var activity = _this.getActivity(activityId);
          // Configure the activity as a target.
          plumber.makeTarget(activityElement, {
            dropOptions: {
              hoverClass: 'hover'
            },
            anchor: 'Continuous',
            endpoint: ['Blank', {
              radius: 8
            }]
          });
          // Add source endpoints.
          for (var _i = 0, _a = activity.outcomes; _i < _a.length; _i++) {
            var outcome = _a[_i];
            var sourceEndpointOptions = _this.getSourceEndpointOptions(activity, outcome);
            plumber.addEndpoint(activityElement, {
              connectorOverlays: [['Label', {
                label: outcome.displayName,
                cssClass: 'connection-label'
              }]]
            }, sourceEndpointOptions);
          }
        });
        // Connect activities.
        _this.updateConnections(plumber);
        // Re-query the activity elements.
        activityElements = _this.getActivityElements();
        // Make all activity elements visible.
        activityElements.show();
        _this.updateCanvasHeight();
      });
      _this.jsPlumbInstance = plumber;
    });
    return _this;
  }
  return WorkflowViewer;
}(WorkflowCanvas);
$.fn.workflowViewer = function () {
  this.each(function (index, element) {
    var $element = $(element);
    var workflowType = $element.data('workflow-type');
    $element.data('workflowViewer', new WorkflowViewer(element, workflowType));
  });
  return this;
};
$(document).ready(function () {
  var workflowViewer = $('.workflow-canvas').workflowViewer().data('workflowViewer');
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndvcmtmbG93LWNhbnZhcy50cyIsIndvcmtmbG93LWNhbnZhcy5qcyIsIndvcmtmbG93LXZpZXdlci50cyIsIndvcmtmbG93LXZpZXdlci5qcyJdLCJuYW1lcyI6WyJXb3JrZmxvd0NhbnZhcyIsImNvbnRhaW5lciIsIndvcmtmbG93VHlwZSIsIl90aGlzIiwibWluQ2FudmFzSGVpZ2h0IiwiZ2V0QWN0aXZpdHlFbGVtZW50cyIsIiQiLCJmaW5kIiwiZ2V0RGVmYXVsdHMiLCJBbmNob3IiLCJEcmFnT3B0aW9ucyIsImN1cnNvciIsInpJbmRleCIsIkVuZHBvaW50U3R5bGVzIiwiZmlsbFN0eWxlIiwiRW5kcG9pbnRzIiwicmFkaXVzIiwiQ29ubmVjdGlvbk92ZXJsYXlzIiwid2lkdGgiLCJsZW5ndGgiLCJsb2NhdGlvbiIsIkNvbm5lY3RvclpJbmRleCIsImNyZWF0ZUpzUGx1bWJJbnN0YW5jZSIsImpzUGx1bWIiLCJnZXRJbnN0YW5jZSIsInZpc2libGUiLCJpZCIsImNzc0NsYXNzIiwiQ29udGFpbmVyIiwiZ2V0RW5kcG9pbnRDb2xvciIsImFjdGl2aXR5IiwiaXNCbG9ja2luZyIsImlzU3RhcnQiLCJpc0V2ZW50IiwiZ2V0U291cmNlRW5kcG9pbnRPcHRpb25zIiwib3V0Y29tZSIsInBhaW50Q29sb3IiLCJlbmRwb2ludCIsImFuY2hvciIsInBhaW50U3R5bGUiLCJzdHJva2UiLCJmaWxsIiwic3Ryb2tlV2lkdGgiLCJpc1NvdXJjZSIsImNvbm5lY3RvciIsInN0dWIiLCJnYXAiLCJjb3JuZXJSYWRpdXMiLCJhbHdheXNSZXNwZWN0U3R1YnMiLCJjb25uZWN0b3JTdHlsZSIsImpvaW5zdHlsZSIsIm91dGxpbmVTdHJva2UiLCJvdXRsaW5lV2lkdGgiLCJob3ZlclBhaW50U3R5bGUiLCJjb25uZWN0b3JIb3ZlclN0eWxlIiwiY29ubmVjdG9yT3ZlcmxheXMiLCJkcmFnT3B0aW9ucyIsInV1aWQiLCJjb25jYXQiLCJuYW1lIiwicGFyYW1ldGVycyIsImdldEFjdGl2aXR5IiwiYWN0aXZpdGllcyIsImdyZXAiLCJ4IiwidXBkYXRlQ29ubmVjdGlvbnMiLCJwbHVtYmVyIiwid29ya2Zsb3dJZCIsIl9pIiwiX2EiLCJ0cmFuc2l0aW9ucyIsInRyYW5zaXRpb25Nb2RlbCIsInNvdXJjZUVuZHBvaW50VXVpZCIsInNvdXJjZUFjdGl2aXR5SWQiLCJzb3VyY2VPdXRjb21lTmFtZSIsInNvdXJjZUVuZHBvaW50IiwiZ2V0RW5kcG9pbnQiLCJkZXN0aW5hdGlvbkVsZW1lbnRJZCIsImRlc3RpbmF0aW9uQWN0aXZpdHlJZCIsImNvbm5lY3QiLCJzb3VyY2UiLCJ0YXJnZXQiLCJ1cGRhdGVDYW52YXNIZWlnaHQiLCIkY29udGFpbmVyIiwiJGFjdGl2aXR5RWxlbWVudHMiLCJjdXJyZW50RWxlbWVudFRvcCIsImN1cnJlbnRBY3Rpdml0eUhlaWdodCIsInRvQXJyYXkiLCJhY3Rpdml0eUVsZW1lbnQiLCIkYWN0aXZpdHlFbGVtZW50IiwidG9wXzEiLCJwb3NpdGlvbiIsInRvcCIsImhlaWdodCIsIm5ld0NhbnZhc0hlaWdodCIsImVsZW1lbnRCb3R0b20iLCJzdHJldGNoVmFsdWUiLCJNYXRoIiwibWF4IiwiX19leHRlbmRzIiwiZXh0ZW5kU3RhdGljcyIsImQiLCJiIiwiT2JqZWN0Iiwic2V0UHJvdG90eXBlT2YiLCJfX3Byb3RvX18iLCJBcnJheSIsInAiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJUeXBlRXJyb3IiLCJTdHJpbmciLCJfXyIsImNvbnN0cnVjdG9yIiwiY3JlYXRlIiwiV29ya2Zsb3dWaWV3ZXIiLCJfc3VwZXIiLCJzZWxmIiwicmVhZHkiLCJpbXBvcnREZWZhdWx0cyIsImJpbmQiLCJjb25uSW5mbyIsIm9yaWdpbmFsRXZlbnQiLCJjb25uZWN0aW9uIiwiZ2V0UGFyYW1ldGVycyIsImxhYmVsIiwiZ2V0T3ZlcmxheSIsInNldExhYmVsIiwiZGlzcGxheU5hbWUiLCJhY3Rpdml0eUVsZW1lbnRzIiwiYXJlRXF1YWxPdXRjb21lcyIsIm91dGNvbWVzMSIsIm91dGNvbWVzMiIsImkiLCJvdXRjb21lMSIsIm91dGNvbWUyIiwiYmF0Y2giLCJlYWNoIiwiaW5kZXgiLCJhY3Rpdml0eUlkIiwiZGF0YSIsIm1ha2VUYXJnZXQiLCJkcm9wT3B0aW9ucyIsImhvdmVyQ2xhc3MiLCJvdXRjb21lcyIsInNvdXJjZUVuZHBvaW50T3B0aW9ucyIsImFkZEVuZHBvaW50Iiwic2hvdyIsImpzUGx1bWJJbnN0YW5jZSIsImZuIiwid29ya2Zsb3dWaWV3ZXIiLCJlbGVtZW50IiwiJGVsZW1lbnQiLCJkb2N1bWVudCJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFFQSxJQUFBQSxjQUFBLEdBQUEsYUFBQSxZQUFBO0VBR0ksU0FBQUEsY0FBQUEsQ0FBc0JDLFNBQXNCLEVBQVlDLFlBQW9DLEVBQUE7SUFBNUYsSUFBQUMsS0FBQSxHQUFBLElBQUE7SUFBc0IsSUFBQSxDQUFBRixTQUFTLEdBQVRBLFNBQVM7SUFBeUIsSUFBQSxDQUFBQyxZQUFZLEdBQVpBLFlBQVk7SUFGNUQsSUFBQSxDQUFBRSxlQUFlLEdBQVcsR0FBRztJQUszQixJQUFBLENBQUFDLG1CQUFtQixHQUFHLFlBQUE7TUFDNUIsT0FBT0MsQ0FBQyxDQUFDSCxLQUFJLENBQUNGLFNBQVMsQ0FBQyxDQUFDTSxJQUFJLENBQUMsV0FBVyxDQUFDO0lBQzlDLENBQUM7SUFFUyxJQUFBLENBQUFDLFdBQVcsR0FBRyxZQUFBO01BQ3BCLE9BQU87UUFDSEMsTUFBTSxFQUFFLFlBQVk7UUFDcEJDLFdBQVcsRUFBRTtVQUFFQyxNQUFNLEVBQUUsU0FBUztVQUFFQyxNQUFNLEVBQUU7UUFBSSxDQUFFO1FBQ2hEQyxjQUFjLEVBQUUsQ0FBQztVQUFFQyxTQUFTLEVBQUU7UUFBUyxDQUFFLENBQUM7UUFDMUNDLFNBQVMsRUFBRSxDQUFDLENBQUMsS0FBSyxFQUFFO1VBQUVDLE1BQU0sRUFBRTtRQUFDLENBQUUsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDOUNDLGtCQUFr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QWlCLENBQUNDLE9BQU8sQ0FBQztRQUUvQjtRQUNBZ0UsZ0JBQWdCLEdBQUcvSCxLQUFJLENBQUNFLG1CQUFtQixDQUFBLENBQUU7UUFFN0M7UUFDQTZILGdCQUFnQixDQUFDa0IsSUFBSSxDQUFBLENBQUU7UUFFdkJqSixLQUFJLENBQUMrRSxrQkFBa0IsQ0FBQSxDQUFFO01BQzdCLENBQUMsQ0FBQztNQUVGL0UsS0FBSSxDQUFDa0osZUFBZSxHQUFHbkYsT0FBTztJQUNsQyxDQUFDLENBQUM7SUNFRixPQUFPL0QsS0FBSztFRERoQjtFQUtKLE9BQUFpSCxjQUFDO0FBQUQsQ0FsRkEsQ0FBNkJwSCxjQUFjLENBQUE7QUFvRjNDTSxDQUFDLENBQUNnSixFQUFFLENBQUNDLGNBQWMsR0FBRyxZQUFBO0VBQ2xCLElBQUksQ0FBQ2IsSUFBSSxDQUFDLFVBQUNDLEtBQUssRUFBRWEsT0FBTyxFQUFBO0lBQ3JCLElBQUlDLFFBQVEsR0FBR25KLENBQUMsQ0FBQ2tKLE9BQU8sQ0FBQztJQUN6QixJQUFJdEosWUFBWSxHQUEyQnVKLFFBQVEsQ0FBQ1osSUFBSSxDQUFDLGVBQWUsQ0FBQztJQUV6RVksUUFBUSxDQUFDWixJQUFJLENBQUMsZ0JBQWdCLEVBQUUsSUFBSXpCLGNBQWMsQ0FBQ29DLE9BQU8sRUFBRXRKLFlBQVksQ0FBQyxDQUFDO0VBQzlFLENBQUMsQ0FBQztFQUVGLE9BQU8sSUFBSTtBQUNmLENBQUM7QUFFREksQ0FBQyxDQUFDb0osUUFBUSxDQUFDLENBQUNuQyxLQUFLLENBQUMsWUFBQTtFQUNkLElBQU1nQyxjQUFjLEdBQW1CakosQ0FBQyxDQUFDLGtCQUFrQixDQUFDLENBQUNpSixjQUFjLENBQUEsQ0FBRSxDQUFDVixJQUFJLENBQUMsZ0JBQWdCLENBQUM7QUFDeEcsQ0FBQyxDQUFDIiwiZmlsZSI6Im9yY2hhcmQud29ya2Zsb3dzLXZpZXdlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pxdWVyeS90eXBpbmdzLmQudHMnIC8+XHJcbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pzcGx1bWIvdHlwaW5ncy5kLnRzJyAvPlxyXG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4vd29ya2Zsb3ctbW9kZWxzLnRzJyAvPlxyXG5cclxuYWJzdHJhY3QgY2xhc3MgV29ya2Zsb3dDYW52YXMge1xyXG4gICAgcHJpdmF0ZSBtaW5DYW52YXNIZWlnaHQ6IG51bWJlciA9IDQwMDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgY29udGFpbmVyOiBIVE1MRWxlbWVudCwgcHJvdGVjdGVkIHdvcmtmbG93VHlwZTogV29ya2Zsb3dzLldvcmtmbG93VHlwZSkge1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBnZXRBY3Rpdml0eUVsZW1lbnRzID0gKCk6IEpRdWVyeSA9PiB7XHJcbiAgICAgICAgcmV0dXJuICQodGhpcy5jb250YWluZXIpLmZpbmQoJy5hY3Rpdml0eScpO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBnZXREZWZhdWx0cyA9ICgpID0+IHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBBbmNob3I6IFwiQ29udGludW91c1wiLFxyXG4gICAgICAgICAgICBEcmFnT3B0aW9uczogeyBjdXJzb3I6ICdwb2ludGVyJywgekluZGV4OiAyMDAwIH0sXHJcbiAgICAgICAgICAgIEVuZHBvaW50U3R5bGVzOiBbeyBmaWxsU3R5bGU6ICcjMjI1NTg4JyB9XSxcclxuICAgICAgICAgICAgRW5kcG9pbnRzOiBbW1wiRG90XCIsIHsgcmFkaXVzOiA3IH1dLCBbXCJCbGFua1wiXV0sXHJcbiAgICAgICAgICAgIENvbm5lY3Rpb25PdmVybGF5czogW1xyXG4gICAgICAgICAgICAgICAgW1wiQXJyb3dcIiwgeyB3aWR0aDogMTIsIGxlbmd0aDogMTIsIGxvY2F0aW9uOiAtNSB9XSxcclxuICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgQ29ubmVjdG9yWkluZGV4OiA1XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBwcm90ZWN0ZWQgY3JlYXRlSnNQbHVtYkluc3RhbmNlID0gKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBqc1BsdW1iLmdldEluc3RhbmNlKHtcclxuICAgICAgICAgICAgRHJhZ09wdGlvbnM6IHsgY3Vyc29yOiAncG9pbnRlcicsIHpJbmRleDogMjAwMCB9LFxyXG4gICAgICAgICAgICBDb25uZWN0aW9uT3ZlcmxheXM6IFtcclxuICAgICAgICAgICAgICAgIFsnQXJyb3cnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTEsXHJcbiAgICAgICAgICAgICAgICAgICAgbGVuZ3RoOiAxMVxyXG4gICAgICAgICAgICAgICAgfV0sXHJcbiAgICAgICAgICAgICAgICBbJ0xhYmVsJywge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiAwLjUsXHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdsYWJlbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY3NzQ2xhc3M6ICdjb25uZWN0aW9uLWxhYmVsJ1xyXG4gICAgICAgICAgICAgICAgfV1cclxuICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgQ29udGFpbmVyOiB0aGlzLmNvbnRhaW5lclxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBwcm90ZWN0ZWQgZ2V0RW5kcG9pbnRDb2xvciA9IChhY3Rpdml0eTogV29ya2Zsb3dzLkFjdGl2aXR5KSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGFjdGl2aXR5LmlzQmxvY2tpbmcgfHwgYWN0aXZpdHkuaXNTdGFydCA/ICcjN2FiMDJjJyA6IGFjdGl2aXR5LmlzRXZlbnQgPyAnIzNhOGFjZCcgOiAnIzdhYjAyYyc7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGdldFNvdXJjZUVuZHBvaW50T3B0aW9ucyA9IChhY3Rpdml0eTogV29ya2Zsb3dzLkFjdGl2aXR5LCBvdXRjb21lOiBXb3JrZmxvd3MuT3V0Y29tZSk6IEVuZHBvaW50T3B0aW9ucyA9PiB7XHJcbiAgICAgICAgLy8gVGhlIGRlZmluaXRpb24gb2Ygc291cmNlIGVuZHBvaW50cy5cclxuICAgICAgICBjb25zdCBwYWludENvbG9yID0gdGhpcy5nZXRFbmRwb2ludENvbG9yKGFjdGl2aXR5KTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBlbmRwb2ludDogJ0RvdCcsXHJcbiAgICAgICAgICAgIGFuY2hvcjogJ0NvbnRpbnVvdXMnLFxyXG4gICAgICAgICAgICBwYWludFN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICBzdHJva2U6IHBhaW50Q29sb3IsXHJcbiAgICAgICAgICAgICAgICBmaWxsOiBwYWludENvbG9yLFxyXG4gICAgICAgICAgICAgICAgcmFkaXVzOiA3LFxyXG4gICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDFcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgaXNTb3VyY2U6IHRydWUsXHJcbiAgICAgICAgICAgIGNvbm5lY3RvcjogWydGbG93Y2hhcnQnLCB7IHN0dWI6IFs0MCwgNjBdLCBnYXA6IDAsIGNvcm5lclJhZGl1czogNSwgYWx3YXlzUmVzcGVjdFN0dWJzOiB0cnVlIH1dLFxyXG4gICAgICAgICAgICBjb25uZWN0b3JTdHlsZToge1xyXG4gICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXHJcbiAgICAgICAgICAgICAgICBzdHJva2U6ICcjOTk5OTk5JyxcclxuICAgICAgICAgICAgICAgIGpvaW5zdHlsZTogJ3JvdW5kJyxcclxuICAgICAgICAgICAgICAgIG91dGxpbmVTdHJva2U6ICd3aGl0ZScsXHJcbiAgICAgICAgICAgICAgICBvdXRsaW5lV2lkdGg6IDJcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgaG92ZXJQYWludFN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICBmaWxsOiAnIzIxNjQ3NycsXHJcbiAgICAgICAgICAgICAgICBzdHJva2U6ICcjMjE2NDc3J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjb25uZWN0b3JIb3ZlclN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICBzdHJva2VXaWR0aDogMyxcclxuICAgICAgICAgICAgICAgIHN0cm9rZTogJyMyMTY0NzcnLFxyXG4gICAgICAgICAgICAgICAgb3V0bGluZVdpZHRoOiA1LFxyXG4gICAgICAgICAgICAgICAgb3V0bGluZVN0cm9rZTogJ3doaXRlJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjb25uZWN0b3JPdmVybGF5czogW1snTGFiZWwnLCB7IGxvY2F0aW9uOiBbMywgLTEuNV0sIGNzc0NsYXNzOiAnZW5kcG9pbnRTb3VyY2VMYWJlbCcgfV1dLFxyXG4gICAgICAgICAgICBkcmFnT3B0aW9uczoge30sXHJcbiAgICAgICAgICAgIHV1aWQ6IGAke2FjdGl2aXR5LmlkfS0ke291dGNvbWUubmFtZX1gLFxyXG4gICAgICAgICAgICBwYXJhbWV0ZXJzOiB7XHJcbiAgICAgICAgICAgICAgICBvdXRjb21lOiBvdXRjb21lXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICBwcm90ZWN0ZWQgZ2V0QWN0aXZpdHkgPSBmdW5jdGlvbiAoaWQ6IHN0cmluZywgYWN0aXZpdGllczogQXJyYXk8V29ya2Zsb3dzLkFjdGl2aXR5PiA9IG51bGwpOiBXb3JrZmxvd3MuQWN0aXZpdHkge1xyXG4gICAgICAgIGlmICghYWN0aXZpdGllcykge1xyXG4gICAgICAgICAgICBhY3Rpdml0aWVzID0gdGhpcy53b3JrZmxvd1R5cGUuYWN0aXZpdGllcztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICQuZ3JlcChhY3Rpdml0aWVzLCAoeDogV29ya2Zsb3dzLkFjdGl2aXR5KSA9PiB4LmlkID09PSBpZClbMF07XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIHVwZGF0ZUNvbm5lY3Rpb25zID0gKHBsdW1iZXI6IGpzUGx1bWJJbnN0YW5jZSkgPT4ge1xyXG4gICAgICAgIHZhciB3b3JrZmxvd0lkOiBudW1iZXIgPSB0aGlzLndvcmtmbG93VHlwZS5pZDtcclxuXHJcbiAgICAgICAgLy8gQ29ubmVjdCBhY3Rpdml0aWVzLlxyXG4gICAgICAgIGZvciAobGV0IHRyYW5zaXRpb25Nb2RlbCBvZiB0aGlzLndvcmtmbG93VHlwZS50cmFuc2l0aW9ucykge1xyXG4gICAgICAgICAgICBjb25zdCBzb3VyY2VFbmRwb2ludFV1aWQ6IHN0cmluZyA9IGAke3RyYW5zaXRpb25Nb2RlbC5zb3VyY2VBY3Rpdml0eUlkfS0ke3RyYW5zaXRpb25Nb2RlbC5zb3VyY2VPdXRjb21lTmFtZX1gO1xyXG4gICAgICAgICAgICBjb25zdCBzb3VyY2VFbmRwb2ludDogRW5kcG9pbnQgPSBwbHVtYmVyLmdldEVuZHBvaW50KHNvdXJjZUVuZHBvaW50VXVpZCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uRWxlbWVudElkOiBzdHJpbmcgPSBgYWN0aXZpdHktJHt3b3JrZmxvd0lkfS0ke3RyYW5zaXRpb25Nb2RlbC5kZXN0aW5hdGlvbkFjdGl2aXR5SWR9YDtcclxuXHJcbiAgICAgICAgICAgIHBsdW1iZXIuY29ubmVjdCh7XHJcbiAgICAgICAgICAgICAgICBzb3VyY2U6IHNvdXJjZUVuZHBvaW50LFxyXG4gICAgICAgICAgICAgICAgdGFyZ2V0OiBkZXN0aW5hdGlvbkVsZW1lbnRJZFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIHVwZGF0ZUNhbnZhc0hlaWdodCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zdCAkY29udGFpbmVyID0gJCh0aGlzLmNvbnRhaW5lcik7XHJcblxyXG4gICAgICAgIC8vIEdldCB0aGUgYWN0aXZpdHkgZWxlbWVudCB3aXRoIHRoZSBoaWdoZXN0IFkgY29vcmRpbmF0ZS5cclxuICAgICAgICBjb25zdCAkYWN0aXZpdHlFbGVtZW50cyA9ICRjb250YWluZXIuZmluZChcIi5hY3Rpdml0eVwiKTtcclxuICAgICAgICBsZXQgY3VycmVudEVsZW1lbnRUb3AgPSAwO1xyXG4gICAgICAgIGxldCBjdXJyZW50QWN0aXZpdHlIZWlnaHQgPSAwO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBhY3Rpdml0eUVsZW1lbnQgb2YgJGFjdGl2aXR5RWxlbWVudHMudG9BcnJheSgpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0ICRhY3Rpdml0eUVsZW1lbnQgPSAkKGFjdGl2aXR5RWxlbWVudCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHRvcCA9ICRhY3Rpdml0eUVsZW1lbnQucG9zaXRpb24oKS50b3A7XHJcblxyXG4gICAgICAgICAgICBpZiAodG9wID4gY3VycmVudEVsZW1lbnRUb3ApIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRFbGVtZW50VG9wID0gdG9wO1xyXG4gICAgICAgICAgICAgICAgY3VycmVudEFjdGl2aXR5SGVpZ2h0ID0gJGFjdGl2aXR5RWxlbWVudC5oZWlnaHQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IG5ld0NhbnZhc0hlaWdodCA9IGN1cnJlbnRFbGVtZW50VG9wICsgY3VycmVudEFjdGl2aXR5SGVpZ2h0O1xyXG4gICAgICAgIGNvbnN0IGVsZW1lbnRCb3R0b20gPSBjdXJyZW50RWxlbWVudFRvcCArIGN1cnJlbnRBY3Rpdml0eUhlaWdodDtcclxuICAgICAgICBjb25zdCBzdHJldGNoVmFsdWUgPSAxMDA7XHJcblxyXG4gICAgICAgIGlmIChuZXdDYW52YXNIZWlnaHQgLSBlbGVtZW50Qm90dG9tIDw9IHN0cmV0Y2hWYWx1ZSkge1xyXG4gICAgICAgICAgICBuZXdDYW52YXNIZWlnaHQgKz0gc3RyZXRjaFZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGNvbnRhaW5lci5oZWlnaHQoTWF0aC5tYXgodGhpcy5taW5DYW52YXNIZWlnaHQsIG5ld0NhbnZhc0hlaWdodCkpO1xyXG4gICAgfTtcclxufVxyXG4iLCIvLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qcXVlcnkvdHlwaW5ncy5kLnRzJyAvPlxuLy8vPHJlZmVyZW5jZSBwYXRoPScuLi9MaWIvanNwbHVtYi90eXBpbmdzLmQudHMnIC8+XG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4vd29ya2Zsb3ctbW9kZWxzLnRzJyAvPlxudmFyIFdvcmtmbG93Q2FudmFzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFdvcmtmbG93Q2FudmFzKGNvbnRhaW5lciwgd29ya2Zsb3dUeXBlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xuICAgICAgICB0aGlzLndvcmtmbG93VHlwZSA9IHdvcmtmbG93VHlwZTtcbiAgICAgICAgdGhpcy5taW5DYW52YXNIZWlnaHQgPSA0MDA7XG4gICAgICAgIHRoaXMuZ2V0QWN0aXZpdHlFbGVtZW50cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiAkKF90aGlzLmNvbnRhaW5lcikuZmluZCgnLmFjdGl2aXR5Jyk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZ2V0RGVmYXVsdHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIEFuY2hvcjogXCJDb250aW51b3VzXCIsXG4gICAgICAgICAgICAgICAgRHJhZ09wdGlvbnM6IHsgY3Vyc29yOiAncG9pbnRlcicsIHpJbmRleDogMjAwMCB9LFxuICAgICAgICAgICAgICAgIEVuZHBvaW50U3R5bGVzOiBbeyBmaWxsU3R5bGU6ICcjMjI1NTg4JyB9XSxcbiAgICAgICAgICAgICAgICBFbmRwb2ludHM6IFtbXCJEb3RcIiwgeyByYWRpdXM6IDcgfV0sIFtcIkJsYW5rXCJdXSxcbiAgICAgICAgICAgICAgICBDb25uZWN0aW9uT3ZlcmxheXM6IFtcbiAgICAgICAgICAgICAgICAgICAgW1wiQXJyb3dcIiwgeyB3aWR0aDogMTIsIGxlbmd0aDogMTIsIGxvY2F0aW9uOiAtNSB9XSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIENvbm5lY3RvclpJbmRleDogNVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jcmVhdGVKc1BsdW1iSW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4ganNQbHVtYi5nZXRJbnN0YW5jZSh7XG4gICAgICAgICAgICAgICAgRHJhZ09wdGlvbnM6IHsgY3Vyc29yOiAncG9pbnRlcicsIHpJbmRleDogMjAwMCB9LFxuICAgICAgICAgICAgICAgIENvbm5lY3Rpb25PdmVybGF5czogW1xuICAgICAgICAgICAgICAgICAgICBbJ0Fycm93Jywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDExLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aDogMTFcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgICAgICAgICBbJ0xhYmVsJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiAwLjUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICdsYWJlbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3NzQ2xhc3M6ICdjb25uZWN0aW9uLWxhYmVsJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIENvbnRhaW5lcjogX3RoaXMuY29udGFpbmVyXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5nZXRFbmRwb2ludENvbG9yID0gZnVuY3Rpb24gKGFjdGl2aXR5KSB7XG4gICAgICAgICAgICByZXR1cm4gYWN0aXZpdHkuaXNCbG9ja2luZyB8fCBhY3Rpdml0eS5pc1N0YXJ0ID8gJyM3YWIwMmMnIDogYWN0aXZpdHkuaXNFdmVudCA/ICcjM2E4YWNkJyA6ICcjN2FiMDJjJztcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5nZXRTb3VyY2VFbmRwb2ludE9wdGlvbnMgPSBmdW5jdGlvbiAoYWN0aXZpdHksIG91dGNvbWUpIHtcbiAgICAgICAgICAgIC8vIFRoZSBkZWZpbml0aW9uIG9mIHNvdXJjZSBlbmRwb2ludHMuXG4gICAgICAgICAgICB2YXIgcGFpbnRDb2xvciA9IF90aGlzLmdldEVuZHBvaW50Q29sb3IoYWN0aXZpdHkpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBlbmRwb2ludDogJ0RvdCcsXG4gICAgICAgICAgICAgICAgYW5jaG9yOiAnQ29udGludW91cycsXG4gICAgICAgICAgICAgICAgcGFpbnRTdHlsZToge1xuICAgICAgICAgICAgICAgICAgICBzdHJva2U6IHBhaW50Q29sb3IsXG4gICAgICAgICAgICAgICAgICAgIGZpbGw6IHBhaW50Q29sb3IsXG4gICAgICAgICAgICAgICAgICAgIHJhZGl1czogNyxcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDFcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGlzU291cmNlOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNvbm5lY3RvcjogWydGbG93Y2hhcnQnLCB7IHN0dWI6IFs0MCwgNjBdLCBnYXA6IDAsIGNvcm5lclJhZGl1czogNSwgYWx3YXlzUmVzcGVjdFN0dWJzOiB0cnVlIH1dLFxuICAgICAgICAgICAgICAgIGNvbm5lY3RvclN0eWxlOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxuICAgICAgICAgICAgICAgICAgICBzdHJva2U6ICcjOTk5OTk5JyxcbiAgICAgICAgICAgICAgICAgICAgam9pbnN0eWxlOiAncm91bmQnLFxuICAgICAgICAgICAgICAgICAgICBvdXRsaW5lU3Ryb2tlOiAnd2hpdGUnLFxuICAgICAgICAgICAgICAgICAgICBvdXRsaW5lV2lkdGg6IDJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGhvdmVyUGFpbnRTdHlsZToge1xuICAgICAgICAgICAgICAgICAgICBmaWxsOiAnIzIxNjQ3NycsXG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZTogJyMyMTY0NzcnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjb25uZWN0b3JIb3ZlclN0eWxlOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAzLFxuICAgICAgICAgICAgICAgICAgICBzdHJva2U6ICcjMjE2NDc3JyxcbiAgICAgICAgICAgICAgICAgICAgb3V0bGluZVdpZHRoOiA1LFxuICAgICAgICAgICAgICAgICAgICBvdXRsaW5lU3Ryb2tlOiAnd2hpdGUnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjb25uZWN0b3JPdmVybGF5czogW1snTGFiZWwnLCB7IGxvY2F0aW9uOiBbMywgLTEuNV0sIGNzc0NsYXNzOiAnZW5kcG9pbnRTb3VyY2VMYWJlbCcgfV1dLFxuICAgICAgICAgICAgICAgIGRyYWdPcHRpb25zOiB7fSxcbiAgICAgICAgICAgICAgICB1dWlkOiBcIlwiLmNvbmNhdChhY3Rpdml0eS5pZCwgXCItXCIpLmNvbmNhdChvdXRjb21lLm5hbWUpLFxuICAgICAgICAgICAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgb3V0Y29tZTogb3V0Y29tZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZ2V0QWN0aXZpdHkgPSBmdW5jdGlvbiAoaWQsIGFjdGl2aXRpZXMpIHtcbiAgICAgICAgICAgIGlmIChhY3Rpdml0aWVzID09PSB2b2lkIDApIHsgYWN0aXZpdGllcyA9IG51bGw7IH1cbiAgICAgICAgICAgIGlmICghYWN0aXZpdGllcykge1xuICAgICAgICAgICAgICAgIGFjdGl2aXRpZXMgPSB0aGlzLndvcmtmbG93VHlwZS5hY3Rpdml0aWVzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICQuZ3JlcChhY3Rpdml0aWVzLCBmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5pZCA9PT0gaWQ7IH0pWzBdO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnVwZGF0ZUNvbm5lY3Rpb25zID0gZnVuY3Rpb24gKHBsdW1iZXIpIHtcbiAgICAgICAgICAgIHZhciB3b3JrZmxvd0lkID0gX3RoaXMud29ya2Zsb3dUeXBlLmlkO1xuICAgICAgICAgICAgLy8gQ29ubmVjdCBhY3Rpdml0aWVzLlxuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IF90aGlzLndvcmtmbG93VHlwZS50cmFuc2l0aW9uczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgdHJhbnNpdGlvbk1vZGVsID0gX2FbX2ldO1xuICAgICAgICAgICAgICAgIHZhciBzb3VyY2VFbmRwb2ludFV1aWQgPSBcIlwiLmNvbmNhdCh0cmFuc2l0aW9uTW9kZWwuc291cmNlQWN0aXZpdHlJZCwgXCItXCIpLmNvbmNhdCh0cmFuc2l0aW9uTW9kZWwuc291cmNlT3V0Y29tZU5hbWUpO1xuICAgICAgICAgICAgICAgIHZhciBzb3VyY2VFbmRwb2ludCA9IHBsdW1iZXIuZ2V0RW5kcG9pbnQoc291cmNlRW5kcG9pbnRVdWlkKTtcbiAgICAgICAgICAgICAgICB2YXIgZGVzdGluYXRpb25FbGVtZW50SWQgPSBcImFjdGl2aXR5LVwiLmNvbmNhdCh3b3JrZmxvd0lkLCBcIi1cIikuY29uY2F0KHRyYW5zaXRpb25Nb2RlbC5kZXN0aW5hdGlvbkFjdGl2aXR5SWQpO1xuICAgICAgICAgICAgICAgIHBsdW1iZXIuY29ubmVjdCh7XG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZTogc291cmNlRW5kcG9pbnQsXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldDogZGVzdGluYXRpb25FbGVtZW50SWRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy51cGRhdGVDYW52YXNIZWlnaHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgJGNvbnRhaW5lciA9ICQodGhpcy5jb250YWluZXIpO1xuICAgICAgICAgICAgLy8gR2V0IHRoZSBhY3Rpdml0eSBlbGVtZW50IHdpdGggdGhlIGhpZ2hlc3QgWSBjb29yZGluYXRlLlxuICAgICAgICAgICAgdmFyICRhY3Rpdml0eUVsZW1lbnRzID0gJGNvbnRhaW5lci5maW5kKFwiLmFjdGl2aXR5XCIpO1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRFbGVtZW50VG9wID0gMDtcbiAgICAgICAgICAgIHZhciBjdXJyZW50QWN0aXZpdHlIZWlnaHQgPSAwO1xuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9ICRhY3Rpdml0eUVsZW1lbnRzLnRvQXJyYXkoKTsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgYWN0aXZpdHlFbGVtZW50ID0gX2FbX2ldO1xuICAgICAgICAgICAgICAgIHZhciAkYWN0aXZpdHlFbGVtZW50ID0gJChhY3Rpdml0eUVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHZhciB0b3BfMSA9ICRhY3Rpdml0eUVsZW1lbnQucG9zaXRpb24oKS50b3A7XG4gICAgICAgICAgICAgICAgaWYgKHRvcF8xID4gY3VycmVudEVsZW1lbnRUb3ApIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudEVsZW1lbnRUb3AgPSB0b3BfMTtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudEFjdGl2aXR5SGVpZ2h0ID0gJGFjdGl2aXR5RWxlbWVudC5oZWlnaHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgbmV3Q2FudmFzSGVpZ2h0ID0gY3VycmVudEVsZW1lbnRUb3AgKyBjdXJyZW50QWN0aXZpdHlIZWlnaHQ7XG4gICAgICAgICAgICB2YXIgZWxlbWVudEJvdHRvbSA9IGN1cnJlbnRFbGVtZW50VG9wICsgY3VycmVudEFjdGl2aXR5SGVpZ2h0O1xuICAgICAgICAgICAgdmFyIHN0cmV0Y2hWYWx1ZSA9IDEwMDtcbiAgICAgICAgICAgIGlmIChuZXdDYW52YXNIZWlnaHQgLSBlbGVtZW50Qm90dG9tIDw9IHN0cmV0Y2hWYWx1ZSkge1xuICAgICAgICAgICAgICAgIG5ld0NhbnZhc0hlaWdodCArPSBzdHJldGNoVmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkY29udGFpbmVyLmhlaWdodChNYXRoLm1heCh0aGlzLm1pbkNhbnZhc0hlaWdodCwgbmV3Q2FudmFzSGVpZ2h0KSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBXb3JrZmxvd0NhbnZhcztcbn0oKSk7XG4iLCIvLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qcXVlcnkvdHlwaW5ncy5kLnRzJyAvPlxyXG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qc3BsdW1iL3R5cGluZ3MuZC50cycgLz5cclxuLy8vPHJlZmVyZW5jZSBwYXRoPScuL3dvcmtmbG93LW1vZGVscy50cycgLz5cclxuLy8vPHJlZmVyZW5jZSBwYXRoPScuL3dvcmtmbG93LWNhbnZhcy50cycgLz5cclxuXHJcbmNsYXNzIFdvcmtmbG93Vmlld2VyIGV4dGVuZHMgV29ya2Zsb3dDYW52YXMge1xyXG4gICAgcHJpdmF0ZSBqc1BsdW1iSW5zdGFuY2U6IGpzUGx1bWJJbnN0YW5jZTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgY29udGFpbmVyOiBIVE1MRWxlbWVudCwgcHJvdGVjdGVkIHdvcmtmbG93VHlwZTogV29ya2Zsb3dzLldvcmtmbG93VHlwZSkge1xyXG4gICAgICAgIHN1cGVyKGNvbnRhaW5lciwgd29ya2Zsb3dUeXBlKTtcclxuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAganNQbHVtYi5yZWFkeSgoKSA9PiB7XHJcbiAgICAgICAgICAgIGpzUGx1bWIuaW1wb3J0RGVmYXVsdHModGhpcy5nZXREZWZhdWx0cygpKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHBsdW1iZXIgPSB0aGlzLmNyZWF0ZUpzUGx1bWJJbnN0YW5jZSgpO1xyXG5cclxuICAgICAgICAgICAgLy8gTGlzdGVuIGZvciBuZXcgY29ubmVjdGlvbnMuXHJcbiAgICAgICAgICAgIHBsdW1iZXIuYmluZCgnY29ubmVjdGlvbicsIGZ1bmN0aW9uIChjb25uSW5mbywgb3JpZ2luYWxFdmVudCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY29ubmVjdGlvbjogQ29ubmVjdGlvbiA9IGNvbm5JbmZvLmNvbm5lY3Rpb247XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvdXRjb21lOiBXb3JrZmxvd3MuT3V0Y29tZSA9IGNvbm5lY3Rpb24uZ2V0UGFyYW1ldGVycygpLm91dGNvbWU7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgbGFiZWw6IGFueSA9IGNvbm5lY3Rpb24uZ2V0T3ZlcmxheSgnbGFiZWwnKTtcclxuICAgICAgICAgICAgICAgIGxhYmVsLnNldExhYmVsKG91dGNvbWUuZGlzcGxheU5hbWUpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGxldCBhY3Rpdml0eUVsZW1lbnRzID0gdGhpcy5nZXRBY3Rpdml0eUVsZW1lbnRzKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgYXJlRXF1YWxPdXRjb21lcyA9IGZ1bmN0aW9uIChvdXRjb21lczE6IFdvcmtmbG93cy5PdXRjb21lW10sIG91dGNvbWVzMjogV29ya2Zsb3dzLk91dGNvbWVbXSk6IGJvb2xlYW4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKG91dGNvbWVzMS5sZW5ndGggIT0gb3V0Y29tZXMyLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG91dGNvbWVzMS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG91dGNvbWUxID0gb3V0Y29tZXMxW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG91dGNvbWUyID0gb3V0Y29tZXMyW2ldO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3V0Y29tZTEubmFtZSAhPSBvdXRjb21lMi5kaXNwbGF5TmFtZSB8fCBvdXRjb21lMS5kaXNwbGF5TmFtZSAhPSBvdXRjb21lMi5kaXNwbGF5TmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBTdXNwZW5kIGRyYXdpbmcgYW5kIGluaXRpYWxpemUuXHJcbiAgICAgICAgICAgIHBsdW1iZXIuYmF0Y2goKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdmFyIHdvcmtmbG93SWQ6IG51bWJlciA9IHRoaXMud29ya2Zsb3dUeXBlLmlkO1xyXG5cclxuICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudHMuZWFjaCgoaW5kZXgsIGFjdGl2aXR5RWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0ICRhY3Rpdml0eUVsZW1lbnQgPSAkKGFjdGl2aXR5RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9ICRhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktaWQnKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3Rpdml0eSA9IHRoaXMuZ2V0QWN0aXZpdHkoYWN0aXZpdHlJZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIENvbmZpZ3VyZSB0aGUgYWN0aXZpdHkgYXMgYSB0YXJnZXQuXHJcbiAgICAgICAgICAgICAgICAgICAgcGx1bWJlci5tYWtlVGFyZ2V0KGFjdGl2aXR5RWxlbWVudCwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkcm9wT3B0aW9uczogeyBob3ZlckNsYXNzOiAnaG92ZXInIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvcjogJ0NvbnRpbnVvdXMnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogWydCbGFuaycsIHsgcmFkaXVzOiA4IH1dXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEFkZCBzb3VyY2UgZW5kcG9pbnRzLlxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IG91dGNvbWUgb2YgYWN0aXZpdHkub3V0Y29tZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc291cmNlRW5kcG9pbnRPcHRpb25zID0gdGhpcy5nZXRTb3VyY2VFbmRwb2ludE9wdGlvbnMoYWN0aXZpdHksIG91dGNvbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbHVtYmVyLmFkZEVuZHBvaW50KGFjdGl2aXR5RWxlbWVudCwgeyBjb25uZWN0b3JPdmVybGF5czogW1snTGFiZWwnLCB7IGxhYmVsOiBvdXRjb21lLmRpc3BsYXlOYW1lLCBjc3NDbGFzczogJ2Nvbm5lY3Rpb24tbGFiZWwnIH1dXSB9LCBzb3VyY2VFbmRwb2ludE9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIENvbm5lY3QgYWN0aXZpdGllcy5cclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQ29ubmVjdGlvbnMocGx1bWJlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUmUtcXVlcnkgdGhlIGFjdGl2aXR5IGVsZW1lbnRzLlxyXG4gICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cyA9IHRoaXMuZ2V0QWN0aXZpdHlFbGVtZW50cygpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIE1ha2UgYWxsIGFjdGl2aXR5IGVsZW1lbnRzIHZpc2libGUuXHJcbiAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzLnNob3coKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNhbnZhc0hlaWdodCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuanNQbHVtYkluc3RhbmNlID0gcGx1bWJlcjtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgZ2V0RW5kcG9pbnRDb2xvciA9IChhY3Rpdml0eTogV29ya2Zsb3dzLkFjdGl2aXR5KSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGFjdGl2aXR5LmlzQmxvY2tpbmcgPyAnIzdhYjAyYycgOiBhY3Rpdml0eS5pc0V2ZW50ID8gJyMzYThhY2QnIDogJyM3YWIwMmMnO1xyXG4gICAgfVxyXG59XHJcblxyXG4kLmZuLndvcmtmbG93Vmlld2VyID0gZnVuY3Rpb24gKHRoaXM6IEpRdWVyeSk6IEpRdWVyeSB7XHJcbiAgICB0aGlzLmVhY2goKGluZGV4LCBlbGVtZW50KSA9PiB7XHJcbiAgICAgICAgdmFyICRlbGVtZW50ID0gJChlbGVtZW50KTtcclxuICAgICAgICB2YXIgd29ya2Zsb3dUeXBlOiBXb3JrZmxvd3MuV29ya2Zsb3dUeXBlID0gJGVsZW1lbnQuZGF0YSgnd29ya2Zsb3ctdHlwZScpO1xyXG5cclxuICAgICAgICAkZWxlbWVudC5kYXRhKCd3b3JrZmxvd1ZpZXdlcicsIG5ldyBXb3JrZmxvd1ZpZXdlcihlbGVtZW50LCB3b3JrZmxvd1R5cGUpKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiB0aGlzO1xyXG59O1xyXG5cclxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc3Qgd29ya2Zsb3dWaWV3ZXI6IFdvcmtmbG93Vmlld2VyID0gJCgnLndvcmtmbG93LWNhbnZhcycpLndvcmtmbG93Vmlld2VyKCkuZGF0YSgnd29ya2Zsb3dWaWV3ZXInKTtcclxufSk7XHJcbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pxdWVyeS90eXBpbmdzLmQudHMnIC8+XG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qc3BsdW1iL3R5cGluZ3MuZC50cycgLz5cbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi93b3JrZmxvdy1tb2RlbHMudHMnIC8+XG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4vd29ya2Zsb3ctY2FudmFzLnRzJyAvPlxudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDbGFzcyBleHRlbmRzIHZhbHVlIFwiICsgU3RyaW5nKGIpICsgXCIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbFwiKTtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbnZhciBXb3JrZmxvd1ZpZXdlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoV29ya2Zsb3dWaWV3ZXIsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gV29ya2Zsb3dWaWV3ZXIoY29udGFpbmVyLCB3b3JrZmxvd1R5cGUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgY29udGFpbmVyLCB3b3JrZmxvd1R5cGUpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICAgICAgX3RoaXMud29ya2Zsb3dUeXBlID0gd29ya2Zsb3dUeXBlO1xuICAgICAgICBfdGhpcy5nZXRFbmRwb2ludENvbG9yID0gZnVuY3Rpb24gKGFjdGl2aXR5KSB7XG4gICAgICAgICAgICByZXR1cm4gYWN0aXZpdHkuaXNCbG9ja2luZyA/ICcjN2FiMDJjJyA6IGFjdGl2aXR5LmlzRXZlbnQgPyAnIzNhOGFjZCcgOiAnIzdhYjAyYyc7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBzZWxmID0gX3RoaXM7XG4gICAgICAgIGpzUGx1bWIucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAganNQbHVtYi5pbXBvcnREZWZhdWx0cyhfdGhpcy5nZXREZWZhdWx0cygpKTtcbiAgICAgICAgICAgIHZhciBwbHVtYmVyID0gX3RoaXMuY3JlYXRlSnNQbHVtYkluc3RhbmNlKCk7XG4gICAgICAgICAgICAvLyBMaXN0ZW4gZm9yIG5ldyBjb25uZWN0aW9ucy5cbiAgICAgICAgICAgIHBsdW1iZXIuYmluZCgnY29ubmVjdGlvbicsIGZ1bmN0aW9uIChjb25uSW5mbywgb3JpZ2luYWxFdmVudCkge1xuICAgICAgICAgICAgICAgIHZhciBjb25uZWN0aW9uID0gY29ubkluZm8uY29ubmVjdGlvbjtcbiAgICAgICAgICAgICAgICB2YXIgb3V0Y29tZSA9IGNvbm5lY3Rpb24uZ2V0UGFyYW1ldGVycygpLm91dGNvbWU7XG4gICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gY29ubmVjdGlvbi5nZXRPdmVybGF5KCdsYWJlbCcpO1xuICAgICAgICAgICAgICAgIGxhYmVsLnNldExhYmVsKG91dGNvbWUuZGlzcGxheU5hbWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgYWN0aXZpdHlFbGVtZW50cyA9IF90aGlzLmdldEFjdGl2aXR5RWxlbWVudHMoKTtcbiAgICAgICAgICAgIHZhciBhcmVFcXVhbE91dGNvbWVzID0gZnVuY3Rpb24gKG91dGNvbWVzMSwgb3V0Y29tZXMyKSB7XG4gICAgICAgICAgICAgICAgaWYgKG91dGNvbWVzMS5sZW5ndGggIT0gb3V0Y29tZXMyLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3V0Y29tZXMxLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvdXRjb21lMSA9IG91dGNvbWVzMVtpXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG91dGNvbWUyID0gb3V0Y29tZXMyW2ldO1xuICAgICAgICAgICAgICAgICAgICBpZiAob3V0Y29tZTEubmFtZSAhPSBvdXRjb21lMi5kaXNwbGF5TmFtZSB8fCBvdXRjb21lMS5kaXNwbGF5TmFtZSAhPSBvdXRjb21lMi5kaXNwbGF5TmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIC8vIFN1c3BlbmQgZHJhd2luZyBhbmQgaW5pdGlhbGl6ZS5cbiAgICAgICAgICAgIHBsdW1iZXIuYmF0Y2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciB3b3JrZmxvd0lkID0gX3RoaXMud29ya2Zsb3dUeXBlLmlkO1xuICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudHMuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGFjdGl2aXR5RWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgJGFjdGl2aXR5RWxlbWVudCA9ICQoYWN0aXZpdHlFbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGl2aXR5SWQgPSAkYWN0aXZpdHlFbGVtZW50LmRhdGEoJ2FjdGl2aXR5LWlkJyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpdml0eSA9IF90aGlzLmdldEFjdGl2aXR5KGFjdGl2aXR5SWQpO1xuICAgICAgICAgICAgICAgICAgICAvLyBDb25maWd1cmUgdGhlIGFjdGl2aXR5IGFzIGEgdGFyZ2V0LlxuICAgICAgICAgICAgICAgICAgICBwbHVtYmVyLm1ha2VUYXJnZXQoYWN0aXZpdHlFbGVtZW50LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkcm9wT3B0aW9uczogeyBob3ZlckNsYXNzOiAnaG92ZXInIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmNob3I6ICdDb250aW51b3VzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OiBbJ0JsYW5rJywgeyByYWRpdXM6IDggfV1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIEFkZCBzb3VyY2UgZW5kcG9pbnRzLlxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gYWN0aXZpdHkub3V0Y29tZXM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3V0Y29tZSA9IF9hW19pXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzb3VyY2VFbmRwb2ludE9wdGlvbnMgPSBfdGhpcy5nZXRTb3VyY2VFbmRwb2ludE9wdGlvbnMoYWN0aXZpdHksIG91dGNvbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGx1bWJlci5hZGRFbmRwb2ludChhY3Rpdml0eUVsZW1lbnQsIHsgY29ubmVjdG9yT3ZlcmxheXM6IFtbJ0xhYmVsJywgeyBsYWJlbDogb3V0Y29tZS5kaXNwbGF5TmFtZSwgY3NzQ2xhc3M6ICdjb25uZWN0aW9uLWxhYmVsJyB9XV0gfSwgc291cmNlRW5kcG9pbnRPcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIC8vIENvbm5lY3QgYWN0aXZpdGllcy5cbiAgICAgICAgICAgICAgICBfdGhpcy51cGRhdGVDb25uZWN0aW9ucyhwbHVtYmVyKTtcbiAgICAgICAgICAgICAgICAvLyBSZS1xdWVyeSB0aGUgYWN0aXZpdHkgZWxlbWVudHMuXG4gICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cyA9IF90aGlzLmdldEFjdGl2aXR5RWxlbWVudHMoKTtcbiAgICAgICAgICAgICAgICAvLyBNYWtlIGFsbCBhY3Rpdml0eSBlbGVtZW50cyB2aXNpYmxlLlxuICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudHMuc2hvdygpO1xuICAgICAgICAgICAgICAgIF90aGlzLnVwZGF0ZUNhbnZhc0hlaWdodCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBfdGhpcy5qc1BsdW1iSW5zdGFuY2UgPSBwbHVtYmVyO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gV29ya2Zsb3dWaWV3ZXI7XG59KFdvcmtmbG93Q2FudmFzKSk7XG4kLmZuLndvcmtmbG93Vmlld2VyID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyICRlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICAgICAgdmFyIHdvcmtmbG93VHlwZSA9ICRlbGVtZW50LmRhdGEoJ3dvcmtmbG93LXR5cGUnKTtcbiAgICAgICAgJGVsZW1lbnQuZGF0YSgnd29ya2Zsb3dWaWV3ZXInLCBuZXcgV29ya2Zsb3dWaWV3ZXIoZWxlbWVudCwgd29ya2Zsb3dUeXBlKSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHRoaXM7XG59O1xuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgIHZhciB3b3JrZmxvd1ZpZXdlciA9ICQoJy53b3JrZmxvdy1jYW52YXMnKS53b3JrZmxvd1ZpZXdlcigpLmRhdGEoJ3dvcmtmbG93Vmlld2VyJyk7XG59KTtcbiJdfQ==
