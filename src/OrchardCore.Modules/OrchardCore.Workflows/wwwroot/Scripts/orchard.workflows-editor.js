/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

///<reference path='../Lib/jquery/typings.d.ts' />
var applyFilter = function applyFilter(category, q) {
  var type = $('.modal-activities').data('activity-type');
  category = category || $('.activity-picker-categories .nav-link.active').attr('href').substr(1);
  q = q || $('.modal-activities input[type=search]').val();
  var $cards = $('.activity.col').show();
  // Remove activities whoes type doesn't match the configured activity type.
  $cards.filter(function (i, el) {
    return $(el).data('activity-type') != type;
  }).hide();
  if (q.length > 0) {
    // Remove activities whose title doesn't match the query.
    $cards.filter(function (i, el) {
      return $(el).find('.card-title').text().toLowerCase().indexOf(q.toLowerCase()) < 0 && q && q.length > 0;
    }).hide();
  } else {
    // Remove activities whose category doesn't match the selected one.
    $cards.filter(function (i, el) {
      return $(el).data('category').toLowerCase() != category.toLowerCase() && category.toLowerCase() != 'all';
    }).hide();
  }
  // Show or hide categories based on whether there are any available activities.
  $('.activity-picker-categories [data-category]').each(function (i, el) {
    var categoryListItem = $(el);
    var category = categoryListItem.data('category');
    // Count number of activities within this category and for the specified activity type (Event or Task).
    var activityCount = $(".activity.col[data-category='".concat(category, "'][data-activity-type='").concat(type, "']")).length;
    activityCount == 0 ? categoryListItem.hide() : categoryListItem.show();
  });
};
$(function () {
  $('.activity-picker-categories').on('click', '.nav-link', function (e) {
    applyFilter($(e.target).attr('href').substr(1), null);
  });
  $('.modal-activities input[type=search]').on('keyup', function (e) {
    applyFilter(null, $(e.target).val());
  });
  $('#activity-picker').on('show.bs.modal', function (event) {
    var modalEvent = event;
    var button = $(modalEvent.relatedTarget); // Button that triggered the modal.
    var title = button.data('picker-title');
    var type = button.data('activity-type');
    var modal = $(this);
    modal.find('[href="#all"]').click();
    modal.find('.modal-title').text(title);
    modal.data('activity-type', type);
    applyFilter(null, null);
  });
});
///<reference path="../../../Assets/Lib/jquery/typings.d.ts" />
$(function () {
  var generateWorkflowUrl = function generateWorkflowUrl() {
    var workflowTypeId = $('[data-workflow-type-id]').data('workflow-type-id');
    var activityId = $('[data-activity-id]').data('activity-id');
    var tokenLifeSpan = $('#token-lifespan').val();
    var generateUrl = $('[data-generate-url]').data('generate-url') + "?workflowTypeId=".concat(workflowTypeId, "&activityId=").concat(activityId, "&tokenLifeSpan=").concat(tokenLifeSpan);
    var antiforgeryHeaderName = $('[data-antiforgery-header-name]').data('antiforgery-header-name');
    var antiforgeryToken = $('[data-antiforgery-token]').data('antiforgery-token');
    var headers = {};
    headers[antiforgeryHeaderName] = antiforgeryToken;
    $.post({
      url: generateUrl,
      headers: headers
    }).done(function (url) {
      $('#workflow-url-text').val(url);
    });
  };
  $('#generate-url-button').on('click', function (e) {
    generateWorkflowUrl();
  });
  if ($('#workflow-url-text').val() == '') {
    generateWorkflowUrl();
  }
});
///<reference path='../Lib/jquery/typings.d.ts' />
///<reference path='../Lib/jsplumb/typings.d.ts' />
///<reference path='./workflow-models.ts' />
var WorkflowCanvas = /** @class */function () {
  function WorkflowCanvas(container, workflowType) {
    var _this = this;
    this.container = container;
    this.workflowType = workflowType;
    this.minCanvasHeight = 400;
    this.getActivityElements = function () {
      return $(_this.container).find('.activity');
    };
    this.getDefaults = function () {
      return {
        Anchor: "Continuous",
        DragOptions: {
          cursor: 'pointer',
          zIndex: 2000
        },
        EndpointStyles: [{
          fillStyle: '#225588'
        }],
        Endpoints: [["Dot", {
          radius: 7
        }], ["Blank"]],
        ConnectionOverlays: [["Arrow", {
          width: 12,
          length: 12,
          location: -5
        }]],
        ConnectorZIndex: 5
      };
    };
    this.createJsPlumbInstance = function () {
      return jsPlumb.getInstance({
        DragOptions: {
          cursor: 'pointer',
          zIndex: 2000
        },
        ConnectionOverlays: [['Arrow', {
          location: 1,
          visible: true,
          width: 11,
          length: 11
        }], ['Label', {
          location: 0.5,
          id: 'label',
          cssClass: 'connection-label'
        }]],
        Container: _this.container
      });
    };
    this.getEndpointColor = function (activity) {
      return activity.isBlocking || activity.isStart ? '#7ab02c' : activity.isEvent ? '#3a8acd' : '#7ab02c';
    };
    this.getSourceEndpointOptions = function (activity, outcome) {
      // The definition of source endpoints.
      var paintColor = _this.getEndpointColor(activity);
      return {
        endpoint: 'Dot',
        anchor: 'Continuous',
        paintStyle: {
          stroke: paintColor,
          fill: paintColor,
          radius: 7,
          strokeWidth: 1
        },
        isSource: true,
        connector: ['Flowchart', {
          stub: [40, 60],
          gap: 0,
          cornerRadius: 5,
          alwaysRespectStubs: true
        }],
        connectorStyle: {
          strokeWidth: 2,
          stroke: '#999999',
          joinstyle: 'round',
          outlineStroke: 'white',
          outlineWidth: 2
        },
        hoverPaintStyle: {
          fill: '#216477',
          stroke: '#216477'
        },
        connectorHoverStyle: {
          strokeWidth: 3,
          stroke: '#216477',
          outlineWidth: 5,
          outlineStroke: 'white'
        },
        connectorOverlays: [['Label', {
          location: [3, -1.5],
          cssClass: 'endpointSourceLabel'
        }]],
        dragOptions: {},
        uuid: "".concat(activity.id, "-").concat(outcome.name),
        parameters: {
          outcome: outcome
        }
      };
    };
    this.getActivity = function (id, activities) {
      if (activities === void 0) {
        activities = null;
      }
      if (!activities) {
        activities = this.workflowType.activities;
      }
      return $.grep(activities, function (x) {
        return x.id === id;
      })[0];
    };
    this.updateConnections = function (plumber) {
      var workflowId = _this.workflowType.id;
      // Connect activities.
      for (var _i = 0, _a = _this.workflowType.transitions; _i < _a.length; _i++) {
        var transitionModel = _a[_i];
        var sourceEndpointUuid = "".concat(transitionModel.sourceActivityId, "-").concat(transitionModel.sourceOutcomeName);
        var sourceEndpoint = plumber.getEndpoint(sourceEndpointUuid);
        var destinationElementId = "activity-".concat(workflowId, "-").concat(transitionModel.destinationActivityId);
        plumber.connect({
          source: sourceEndpoint,
          target: destinationElementId
        });
      }
    };
    this.updateCanvasHeight = function () {
      var $container = $(this.container);
      // Get the activity element with the highest Y coordinate.
      var $activityElements = $container.find(".activity");
      var currentElementTop = 0;
      var currentActivityHeight = 0;
      for (var _i = 0, _a = $activityElements.toArray(); _i < _a.length; _i++) {
        var activityElement = _a[_i];
        var $activityElement = $(activityElement);
        var top_1 = $activityElement.position().top;
        if (top_1 > currentElementTop) {
          currentElementTop = top_1;
          currentActivityHeight = $activityElement.height();
        }
      }
      var newCanvasHeight = currentElementTop + currentActivityHeight;
      var elementBottom = currentElementTop + currentActivityHeight;
      var stretchValue = 100;
      if (newCanvasHeight - elementBottom <= stretchValue) {
        newCanvasHeight += stretchValue;
      }
      $container.height(Math.max(this.minCanvasHeight, newCanvasHeight));
    };
  }
  return WorkflowCanvas;
}();
///<reference path='../Lib/jquery/typings.d.ts' />
///<reference path='../Lib/jsplumb/typings.d.ts' />
///<reference path='./workflow-models.ts' />
///<reference path='./workflow-canvas.ts' />
var __extends = this && this.__extends || function () {
  var _extendStatics = function extendStatics(d, b) {
    _extendStatics = Object.setPrototypeOf || {
      __proto__: []
    } instanceof Array && function (d, b) {
      d.__proto__ = b;
    } || function (d, b) {
      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];
    };
    return _extendStatics(d, b);
  };
  return function (d, b) {
    if (typeof b !== "function" && b !== null) throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
    _extendStatics(d, b);
    function __() {
      this.constructor = d;
    }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
  };
}();
// TODO: Re-implement this using a MVVM approach.
var WorkflowEditor = /** @class */function (_super) {
  __extends(WorkflowEditor, _super);
  function WorkflowEditor(container, workflowType, deleteActivityPrompt, localId, loadLocalState) {
    var _this = _super.call(this, container, workflowType) || this;
    _this.container = container;
    _this.workflowType = workflowType;
    _this.deleteActivityPrompt = deleteActivityPrompt;
    _this.localId = localId;
    _this.getState = function () {
      var $allActivityElements = $(_this.container).find('.activity');
      var workflow = {
        id: _this.workflowType.id,
        activities: [],
        transitions: [],
        removedActivities: _this.workflowType.removedActivities
      };
      // Collect activities.
      for (var i = 0; i < $allActivityElements.length; i++) {
        var $activityElement = $($allActivityElements[i]);
        var activityId = $activityElement.data('activity-id');
        var activityIsStart = $activityElement.data('activity-start');
        var activityIsEvent = $activityElement.data('activity-type') === 'Event';
        var activityPosition = $activityElement.position();
        var activity = _this.getActivity(activityId);
        workflow.activities.push({
          id: activityId,
          isStart: activityIsStart,
          isEvent: activityIsEvent,
          outcomes: activity.outcomes,
          x: activityPosition.left,
          y: activityPosition.top
        });
      }
      // Collect connections.
      var allConnections = _this.jsPlumbInstance.getConnections();
      for (var i = 0; i < allConnections.length; i++) {
        var connection = allConnections[i];
        var sourceEndpoint = connection.endpoints[0];
        var sourceOutcomeName = sourceEndpoint.getParameters().outcome.name;
        var sourceActivityId = $(connection.source).data('activity-id');
        var destinationActivityId = $(connection.target).data('activity-id');
        workflow.transitions.push({
          sourceActivityId: sourceActivityId,
          destinationActivityId: destinationActivityId,
          sourceOutcomeName: sourceOutcomeName
        });
      }
      return workflow;
    };
    _this.serialize = function () {
      var workflow = _this.getState();
      return JSON.stringify(workflow);
    };
    _this.saveLocalState = function () {
      sessionStorage[_this.localId] = _this.serialize();
    };
    _this.loadLocalState = function () {
      return JSON.parse(sessionStorage[_this.localId]);
    };
    var self = _this;
    jsPlumb.ready(function () {
      jsPlumb.importDefaults(_this.getDefaults());
      var plumber = _this.createJsPlumbInstance();
      // Listen for new connections.
      plumber.bind('connection', function (connInfo, originalEvent) {
        var connection = connInfo.connection;
        var outcome = connection.getParameters().outcome;
        var label = connection.getOverlay('label');
        label.setLabel(outcome.displayName);
      });
      var activityElements = _this.getActivityElements();
      var areEqualOutcomes = function areEqualOutcomes(outcomes1, outcomes2) {
        if (outcomes1.length != outcomes2.length) {
          return false;
        }
        for (var i = 0; i < outcomes1.length; i++) {
          var outcome1 = outcomes1[i];
          var outcome2 = outcomes2[i];
          if (outcome1.name != outcome2.displayName || outcome1.displayName != outcome2.displayName) {
            return false;
          }
        }
        return true;
      };
      // Suspend drawing and initialize.
      plumber.batch(function () {
        var serverworkflowType = _this.workflowType;
        var workflowId = _this.workflowType.id;
        if (loadLocalState) {
          var localState = _this.loadLocalState();
          if (localState) {
            _this.workflowType = localState;
          }
        }
        activityElements.each(function (index, activityElement) {
          var $activityElement = $(activityElement);
          var activityId = $activityElement.data('activity-id');
          var isDeleted = _this.workflowType.removedActivities.indexOf(activityId) > -1;
          if (isDeleted) {
            $activityElement.remove();
            return;
          }
          var activity = _this.getActivity(activityId);
          var serverActivity = _this.getActivity(activityId, serverworkflowType.activities);
          // Update the activity's visual state.
          if (loadLocalState) {
            if (activity == null) {
              // This is a newly added activity not yet added to local state.
              activity = serverActivity;
              _this.workflowType.activities.push(activity);
              activity.x = 50;
              activity.y = 50;
            } else {
              // The available outcomes might have changed when editing an activity,
              // so we need to check for that and update the client's activity outcomes if so.
              var sameOutcomes = areEqualOutcomes(activity.outcomes, serverActivity.outcomes);
              if (!sameOutcomes) {
                activity.outcomes = serverActivity.outcomes;
              }
              $activityElement.css({
                left: activity.x,
                top: activity.y
              }).toggleClass('activity-start', activity.isStart).data('activity-start', activity.isStart);
            }
          }
          // Make the activity draggable.
          plumber.draggable(activityElement, {
            grid: [10, 10],
            containment: true,
            start: function start(args) {
              _this.dragStart = {
                left: args.e.screenX,
                top: args.e.screenY
              };
            },
            stop: function stop(args) {
              _this.hasDragged = _this.dragStart.left != args.e.screenX || _this.dragStart.top != args.e.screenY;
              _this.updateCanvasHeight();
            }
          });
          // Configure the activity as a target.
          plumber.makeTarget(activityElement, {
            dropOptions: {
              hoverClass: 'hover'
            },
            anchor: 'Continuous',
            endpoint: ['Blank', {
              radius: 8
            }]
          });
          // Add source endpoints.
          for (var _i = 0, _a = activity.outcomes; _i < _a.length; _i++) {
            var outcome = _a[_i];
            var sourceEndpointOptions = _this.getSourceEndpointOptions(activity, outcome);
            plumber.addEndpoint(activityElement, {
              connectorOverlays: [['Label', {
                label: outcome.displayName,
                cssClass: 'connection-label'
              }]]
            }, sourceEndpointOptions);
          }
        });
        // Connect activities.
        _this.updateConnections(plumber);
        // Re-query the activity elements.
        activityElements = _this.getActivityElements();
        // Make all activity elements visible.
        activityElements.show();
        _this.updateCanvasHeight();
      });
      // Initialize popovers.
      activityElements.popover({
        trigger: 'manual',
        html: true,
        content: function content() {
          var activityElement = $(this);
          var $content = activityElement.find('.activity-commands').clone().show();
          var startButton = $content.find('.activity-start-action');
          var isStart = activityElement.data('activity-start') === true;
          var activityId = activityElement.data('activity-id');
          startButton.attr('aria-pressed', activityElement.data('activity-start'));
          startButton.toggleClass('active', isStart);
          $content.on('click', '.activity-start-action', function (e) {
            e.preventDefault();
            var button = $(e.currentTarget);
            var isStart = button.is('.active');
            activityElement.data('activity-start', isStart);
            activityElement.toggleClass('activity-start', isStart);
          });
          $content.on('click', '.activity-delete-action', function (e) {
            e.preventDefault();
            // TODO: The prompts are really annoying. Consider showing some sort of small message balloon somewhere to undo the action instead.
            //if (!confirm(self.deleteActivityPrompt)) {
            //    return;
            //}
            self.workflowType.removedActivities.push(activityId);
            plumber.remove(activityElement);
            activityElement.popover('dispose');
          });
          $content.on('click', '[data-persist-workflow]', function (e) {
            self.saveLocalState();
          });
          return $content.get(0);
        }
      });
      $(container).on('click', '.activity', function (e) {
        if (_this.hasDragged) {
          _this.hasDragged = false;
          return;
        }
        // if any other popovers are visible, hide them
        if (_this.isPopoverVisible) {
          activityElements.popover('hide');
        }
        var sender = $(e.currentTarget);
        sender.popover('show');
        // handle clicking on the popover itself.
        $('.popover').off('click').on('click', function (e2) {
          e2.stopPropagation();
        });
        e.stopPropagation();
        _this.isPopoverVisible = true;
      });
      $(container).on('dblclick', '.activity', function (e) {
        var sender = $(e.currentTarget);
        var hasEditor = sender.data('activity-has-editor');
        if (hasEditor) {
          _this.saveLocalState();
          sender.find('.activity-edit-action').get(0).click();
        }
      });
      // Hide all popovers when clicking anywhere but on an activity.
      $('body').on('click', function (e) {
        activityElements.popover('hide');
        _this.isPopoverVisible = false;
      });
      // Save local changes if the event target has the 'data-persist-workflow' attribute.
      $('body').on('click', '[data-persist-workflow]', function (e) {
        _this.saveLocalState();
      });
      _this.jsPlumbInstance = plumber;
    });
    return _this;
  }
  return WorkflowEditor;
}(WorkflowCanvas);
$.fn.workflowEditor = function () {
  this.each(function (index, element) {
    var $element = $(element);
    var workflowType = $element.data('workflow-type');
    var deleteActivityPrompt = $element.data('workflow-delete-activity-prompt');
    var localId = $element.data('workflow-local-id');
    var loadLocalState = $element.data('workflow-load-local-state');
    workflowType.removedActivities = workflowType.removedActivities || [];
    $element.data('workflowEditor', new WorkflowEditor(element, workflowType, deleteActivityPrompt, localId, loadLocalState));
  });
  return this;
};
$(document).ready(function () {
  var workflowEditor = $('.workflow-canvas').workflowEditor().data('workflowEditor');
  $('#workflowEditorForm').on('submit', function (s, e) {
    var state = workflowEditor.serialize();
    $('#workflowStateInput').val(state);
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjdGl2aXR5LXBpY2tlci50cyIsImFjdGl2aXR5LXBpY2tlci5qcyIsIndvcmtmbG93LXVybC1nZW5lcmF0b3IudHMiLCJ3b3JrZmxvdy11cmwtZ2VuZXJhdG9yLmpzIiwid29ya2Zsb3ctY2FudmFzLnRzIiwid29ya2Zsb3ctY2FudmFzLmpzIiwid29ya2Zsb3ctZWRpdG9yLnRzIiwid29ya2Zsb3ctZWRpdG9yLmpzIl0sIm5hbWVzIjpbImFwcGx5RmlsdGVyIiwiY2F0ZWdvcnkiLCJxIiwidHlwZSIsIiQiLCJkYXRhIiwiYXR0ciIsInN1YnN0ciIsInZhbCIsIiRjYXJkcyIsInNob3ciLCJmaWx0ZXIiLCJpIiwiZWwiLCJoaWRlIiwibGVuZ3RoIiwiZmluZCIsInRleHQiLCJ0b0xvd2VyQ2FzZSIsImluZGV4T2YiLCJlYWNoIiwiY2F0ZWdvcnlMaXN0SXRlbSIsImFjdGl2aXR5Q291bnQiLCJjb25jYXQiLCJvbiIsImUiLCJ0YXJnZXQiLCJldmVudCIsIm1vZGFsRXZlbnQiLCJidXR0b24iLCJyZWxhdGVkVGFyZ2V0IiwidGl0bGUiLCJtb2RhbCIsImNsaWNrIiwiZ2VuZXJhdGVXb3JrZmxvd1VybCIsIndvcmtmbG93VHlwZUlkIiwiYWN0aXZpdHlJZCIsInRva2VuTGlmZVNwYW4iLCJnZW5lcmF0ZVVybCIsImFudGlmb3JnZXJ5SGVhZGVyTmFtZSIsImFudGlmb3JnZXJ5VG9rZW4iLCJoZWFkZXJzIiwicG9zdCIsInVybCIsImRvbmUiLCJXb3JrZmxvd0NhbnZhcyIsImNvbnRhaW5lciIsIndvcmtmbG93VHlwZSIsIl90aGlzIiwibWluQ2FudmFzSGVpZ2h0IiwiZ2V0QWN0aXZpdHlFbGVtZW50cyIsImdldERlZmF1bHRzIiwiQW5jaG9yIiwiRHJhZ09wdGlvbnMiLCJjdXJzb3IiLCJ6SW5kZXgiLCJFbmRwb2ludFN0eWxlcyIsImZpbGxTdHlsZSIsIkVuZHBvaW50cyIsInJhZGl1cyIsIkNvbm5lY3Rpb25PdmVybGF5cyIsIndpZHRoIiwibG9jYXRpb24iLCJDb25uZWN0b3JaSW5kZXgiLCJjcmVhdGVKc1BsdW1iSW5zdGFuY2UiLCJqc1BsdW1iIiwiZ2V0SW5zdGFuY2UiLCJ2aXNpYmxlIiwiaWQiLCJjc3NDbGFzcyIsIkNvbnRhaW5lciIsImdldEVuZHBvaW50Q29sb3IiLCJhY3Rpdml0eSIsImlzQmxvY2tpbmciLCJpc1N0YXJ0IiwiaXNFdmVudCIsImdldFNvdXJjZUVuZHBvaW50T3B0aW9ucyIsIm91dGNvbWUiLCJwYWludENvbG9yIiwiZW5kcG9pbnQiLCJhbmNob3IiLCJwYWludFN0eWxlIiwic3Ryb2tlIiwiZmlsbCIsInN0cm9rZVdpZHRoIiwiaXNTb3VyY2UiLCJjb25uZWN0b3IiLCJzdHViIiwiZ2FwIiwiY29ybmVyUmFkaXVzIiwiYWx3YXlzUmVzcGVjdFN0dWJzIiwiY29ubmVjdG9yU3R5bGUiLCJqb2luc3R5bGUiLCJvdXRsaW5lU3Ryb2tlIiwib3V0bGluZVdpZHRoIiwiaG92ZXJQYWludFN0eWxlIiwiY29ubmVjdG9ySG92ZXJTdHlsZSIsImNvbm5lY3Rvck92ZXJsYXlzIiwiZHJhZ09wdGlvbnMiLCJ1dWlkIiwibmFtZSIsInBhcmFtZXRlcnMiLCJnZXRBY3Rpdml0eSIsImFjdGl2aXRpZXMiLCJncmVwIiwieCIsInVwZGF0ZUNvbm5lY3Rpb25zIiwicGx1bWJlciIsIndvcmtmbG93SWQiLCJfaSIsIl9hIiwidHJhbnNpdGlvbnMiLCJ0cmFuc2l0aW9uTW9kZWwiLCJzb3VyY2VFbmRwb2ludFV1aWQiLCJzb3VyY2VBY3Rpdml0eUlkIiwic291cmNlT3V0Y29tZU5hbWUiLCJzb3VyY2VFbmRwb2ludCIsImdldEVuZHBvaW50IiwiZGVzdGluYXRpb25FbGVtZW50SWQiLCJkZXN0aW5hdGlvbkFjdGl2aXR5SWQiLCJjb25uZWN0Iiwic291cmNlIiwidXBkYXRlQ2FudmFzSGVpZ2h0IiwiJGNvbnRhaW5lciIsIiRhY3Rpdml0eUVsZW1lbnRzIiwiY3VycmVudEVsZW1lbnRUb3AiLCJjdXJyZW50QWN0aXZpdHlIZWlnaHQiLCJ0b0FycmF5IiwiYWN0aXZpdHlFbGVtZW50IiwiJGFjdGl2aXR5RWxlbWVudCIsInRvcF8xIiwicG9zaXRpb24iLCJ0b3AiLCJoZWlnaHQiLCJuZXdDYW52YXNIZWlnaHQiLCJlbGVtZW50Qm90dG9tIiwic3RyZXRjaFZhbHVlIiwiTWF0aCIsIm1heCIsIl9fZXh0ZW5kcyIsImV4dGVuZFN0YXRpY3MiLCJkIiwiYiIsIk9iamVjdCIsInNldFByb3RvdHlwZU9mIiwiX19wcm90b19fIiwiQXJyYXkiLCJwIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiVHlwZUVycm9yIiwiU3RyaW5nIiwiX18iLCJjb25zdHJ1Y3RvciIsImNyZWF0ZSIsIldvcmtmbG93RWRpdG9yIiwiX3N1cGVyIiwiZGVsZXRlQWN0aXZpdHlQcm9tcHQiLCJsb2NhbElkIiwibG9hZExvY2FsU3RhdGUiLCJnZXRTdGF0ZSIsIiRhbGxBY3Rpdml0eUVsZW1lbnRzIiwid29ya2Zsb3ciLCJyZW1vdmVkQWN0aXZpdGllcyIsImFjdGl2aXR5SXNTdGFydCIsImFjdGl2aXR5SXNFdmVudCIsImFjdGl2aXR5UG9zaXRpb24iLCJwdXNoIiwib3V0Y29tZXMiLCJsZWZ0IiwieSIsImFsbENvbm5lY3Rpb25zIiwianNQbHVtYkluc3RhbmNlIiwiZ2V0Q29ubmVjdGlvbnMiLCJjb25uZWN0aW9uIiwiZW5kcG9pbnRzIiwiZ2V0UGFyYW1ldGVycyIsInNlcmlhbGl6ZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJzYXZlTG9jYWxTdGF0ZSIsInNlc3Npb25TdG9yYWdlIiwicGFyc2UiLCJzZWxmIiwicmVhZHkiLCJpbXBvcnREZWZhdWx0cyIsImJpbmQiLCJjb25uSW5mbyIsIm9yaWdpbmFsRXZlbnQiLCJsYWJlbCIsImdldE92ZXJsYXkiLCJzZXRMYWJlbCIsImRpc3BsYXlOYW1lIiwiYWN0aXZpdHlFbGVtZW50cyIsImFyZUVxdWFsT3V0Y29tZXMiLCJvdXRjb21lczEiLCJvdXRjb21lczIiLCJvdXRjb21lMSIsIm91dGNvbWUyIiwiYmF0Y2giLCJzZXJ2ZXJ3b3JrZmxvd1R5cGUiLCJsb2NhbFN0YXRlIiwiaW5kZXgiLCJpc0RlbGV0ZWQiLCJyZW1vdmUiLCJzZXJ2ZXJBY3Rpdml0eSIsInNhbWVPdXRjb21lcyIsImNzcyIsInRvZ2dsZUNsYXNzIiwiZHJhZ2dhYmxlIiwiZ3JpZCIsImNvbnRhaW5tZW50Iiwic3RhcnQiLCJhcmdzIiwiZHJhZ1N0YXJ0Iiwic2NyZWVuWCIsInNjcmVlblkiLCJzdG9wIiwiaGFzRHJhZ2dlZCIsIm1ha2VUYXJnZXQiLCJkcm9wT3B0aW9ucyIsImhvdmVyQ2xhc3MiLCJzb3VyY2VFbmRwb2ludE9wdGlvbnMiLCJhZGRFbmRwb2ludCIsInBvcG92ZXIiLCJ0cmlnZ2VyIiwiaHRtbCIsImNvbnRlbnQiLCIkY29udGVudCIsImNsb25lIiwic3RhcnRCdXR0b24iLCJwcmV2ZW50RGVmYXVsdCIsImN1cnJlbnRUYXJnZXQiLCJpcyIsImdldCIsImlzUG9wb3ZlclZpc2libGUiLCJzZW5kZXIiLCJvZmYiLCJlMiIsInN0b3BQcm9wYWdhdGlvbiIsImhhc0VkaXRvciIsImZuIiwid29ya2Zsb3dFZGl0b3IiLCJlbGVtZW50IiwiJGVsZW1lbnQiLCJkb2N1bWVudCIsInMiLCJzdGF0ZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTtBQUVBLElBQUlBLFdBQVcsR0FBRyxTQUFkQSxXQUFXQSxDQUFhQyxRQUFnQixFQUFFQyxDQUFTLEVBQUE7RUFDbkQsSUFBTUMsSUFBSSxHQUFHQyxDQUFDLENBQUMsbUJBQW1CLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLGVBQWUsQ0FBQztFQUN6REosUUFBUSxHQUFHQSxRQUFRLElBQUlHLENBQUMsQ0FBQyw4Q0FBOEMsQ0FBQyxDQUFDRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUNDLE1BQU0sQ0FBQyxDQUFDLENBQUM7RUFDL0ZMLENBQUMsR0FBR0EsQ0FBQyxJQUFZRSxDQUFDLENBQUMsc0NBQXNDLENBQUMsQ0FBQ0ksR0FBRyxDQUFBLENBQUU7RUFFaEUsSUFBTUMsTUFBTSxHQUFHTCxD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cy1lZGl0b3IuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qcXVlcnkvdHlwaW5ncy5kLnRzJyAvPlxyXG5cclxudmFyIGFwcGx5RmlsdGVyID0gZnVuY3Rpb24gKGNhdGVnb3J5OiBzdHJpbmcsIHE6IHN0cmluZykge1xyXG4gICAgY29uc3QgdHlwZSA9ICQoJy5tb2RhbC1hY3Rpdml0aWVzJykuZGF0YSgnYWN0aXZpdHktdHlwZScpO1xyXG4gICAgY2F0ZWdvcnkgPSBjYXRlZ29yeSB8fCAkKCcuYWN0aXZpdHktcGlja2VyLWNhdGVnb3JpZXMgLm5hdi1saW5rLmFjdGl2ZScpLmF0dHIoJ2hyZWYnKS5zdWJzdHIoMSk7XHJcbiAgICBxID0gcSB8fCA8c3RyaW5nPiQoJy5tb2RhbC1hY3Rpdml0aWVzIGlucHV0W3R5cGU9c2VhcmNoXScpLnZhbCgpO1xyXG5cclxuICAgIGNvbnN0ICRjYXJkcyA9ICQoJy5hY3Rpdml0eS5jb2wnKS5zaG93KCk7XHJcblxyXG4gICAgLy8gUmVtb3ZlIGFjdGl2aXRpZXMgd2hvZXMgdHlwZSBkb2Vzbid0IG1hdGNoIHRoZSBjb25maWd1cmVkIGFjdGl2aXR5IHR5cGUuXHJcbiAgICAkY2FyZHMuZmlsdGVyKChpLCBlbCkgPT4ge1xyXG4gICAgICAgIHJldHVybiAkKGVsKS5kYXRhKCdhY3Rpdml0eS10eXBlJykgIT0gdHlwZTtcclxuICAgIH0pLmhpZGUoKTtcclxuXHJcbiAgICBpZiAocS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgLy8gUmVtb3ZlIGFjdGl2aXRpZXMgd2hvc2UgdGl0bGUgZG9lc24ndCBtYXRjaCB0aGUgcXVlcnkuXHJcbiAgICAgICAgJGNhcmRzLmZpbHRlcigoaSwgZWwpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuICQoZWwpLmZpbmQoJy5jYXJkLXRpdGxlJykudGV4dCgpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihxLnRvTG93ZXJDYXNlKCkpIDwgMCAmJiBxICYmIHEubGVuZ3RoID4gMDtcclxuICAgICAgICB9KS5oaWRlKCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICAvLyBSZW1vdmUgYWN0aXZpdGllcyB3aG9zZSBjYXRlZ29yeSBkb2Vzbid0IG1hdGNoIHRoZSBzZWxlY3RlZCBvbmUuXHJcbiAgICAgICAgJGNhcmRzLmZpbHRlcigoaSwgZWwpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuICQoZWwpLmRhdGEoJ2NhdGVnb3J5JykudG9Mb3dlckNhc2UoKSAhPSBjYXRlZ29yeS50b0xvd2VyQ2FzZSgpICYmIGNhdGVnb3J5LnRvTG93ZXJDYXNlKCkgIT0gJ2FsbCc7XHJcbiAgICAgICAgfSkuaGlkZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFNob3cgb3IgaGlkZSBjYXRlZ29yaWVzIGJhc2VkIG9uIHdoZXRoZXIgdGhlcmUgYXJlIGFueSBhdmFpbGFibGUgYWN0aXZpdGllcy5cclxuICAgICQoJy5hY3Rpdml0eS1waWNrZXItY2F0ZWdvcmllcyBbZGF0YS1jYXRlZ29yeV0nKS5lYWNoKChpLCBlbCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNhdGVnb3J5TGlzdEl0ZW0gPSAkKGVsKTtcclxuICAgICAgICBjb25zdCBjYXRlZ29yeSA9IGNhdGVnb3J5TGlzdEl0ZW0uZGF0YSgnY2F0ZWdvcnknKTtcclxuXHJcbiAgICAgICAgLy8gQ291bnQgbnVtYmVyIG9mIGFjdGl2aXRpZXMgd2l0aGluIHRoaXMgY2F0ZWdvcnkgYW5kIGZvciB0aGUgc3BlY2lmaWVkIGFjdGl2aXR5IHR5cGUgKEV2ZW50IG9yIFRhc2spLlxyXG4gICAgICAgIGNvbnN0IGFjdGl2aXR5Q291bnQgPSAkKGAuYWN0aXZpdHkuY29sW2RhdGEtY2F0ZWdvcnk9JyR7Y2F0ZWdvcnl9J11bZGF0YS1hY3Rpdml0eS10eXBlPScke3R5cGV9J11gKS5sZW5ndGg7XHJcbiAgICAgICAgYWN0aXZpdHlDb3VudCA9PSAwID8gY2F0ZWdvcnlMaXN0SXRlbS5oaWRlKCkgOiBjYXRlZ29yeUxpc3RJdGVtLnNob3coKTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuJCgoKSA9PiB7XHJcbiAgICAkKCcuYWN0aXZpdHktcGlja2VyLWNhdGVnb3JpZXMnKS5vbignY2xpY2snLCAnLm5hdi1saW5rJywgZSA9PiB7XHJcbiAgICAgICAgYXBwbHlGaWx0ZXIoJChlLnRhcmdldCkuYXR0cignaHJlZicpLnN1YnN0cigxKSwgbnVsbCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkKCcubW9kYWwtYWN0aXZpdGllcyBpbnB1dFt0eXBlPXNlYXJjaF0nKS5vbigna2V5dXAnLCBlID0+IHtcclxuICAgICAgICBhcHBseUZpbHRlcihudWxsLCA8c3RyaW5nPiQoZS50YXJnZXQpLnZhbCgpKTtcclxuICAgIH0pO1xyXG5cclxuICAgICQoJyNhY3Rpdml0eS1waWNrZXInKS5vbignc2hvdy5icy5tb2RhbCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIHZhciBtb2RhbEV2ZW50ID0gZXZlbnQgYXMgYW55O1xyXG4gICAgICAgIHZhciBidXR0b24gPSAkKG1vZGFsRXZlbnQucmVsYXRlZFRhcmdldCk7IC8vIEJ1dHRvbiB0aGF0IHRyaWdnZXJlZCB0aGUgbW9kYWwuXHJcbiAgICAgICAgdmFyIHRpdGxlID0gYnV0dG9uLmRhdGEoJ3BpY2tlci10aXRsZScpO1xyXG4gICAgICAgIHZhciB0eXBlID0gYnV0dG9uLmRhdGEoJ2FjdGl2aXR5LXR5cGUnKTtcclxuICAgICAgICB2YXIgbW9kYWwgPSAkKHRoaXMpO1xyXG4gICAgICAgIG1vZGFsLmZpbmQoJ1tocmVmPVwiI2FsbFwiXScpLmNsaWNrKCk7XHJcbiAgICAgICAgbW9kYWwuZmluZCgnLm1vZGFsLXRpdGxlJykudGV4dCh0aXRsZSk7XHJcbiAgICAgICAgbW9kYWwuZGF0YSgnYWN0aXZpdHktdHlwZScsIHR5cGUpO1xyXG4gICAgICAgIGFwcGx5RmlsdGVyKG51bGwsIG51bGwpO1xyXG4gICAgfSlcclxufSk7XHJcbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pxdWVyeS90eXBpbmdzLmQudHMnIC8+XG52YXIgYXBwbHlGaWx0ZXIgPSBmdW5jdGlvbiAoY2F0ZWdvcnksIHEpIHtcbiAgICB2YXIgdHlwZSA9ICQoJy5tb2RhbC1hY3Rpdml0aWVzJykuZGF0YSgnYWN0aXZpdHktdHlwZScpO1xuICAgIGNhdGVnb3J5ID0gY2F0ZWdvcnkgfHwgJCgnLmFjdGl2aXR5LXBpY2tlci1jYXRlZ29yaWVzIC5uYXYtbGluay5hY3RpdmUnKS5hdHRyKCdocmVmJykuc3Vic3RyKDEpO1xuICAgIHEgPSBxIHx8ICQoJy5tb2RhbC1hY3Rpdml0aWVzIGlucHV0W3R5cGU9c2VhcmNoXScpLnZhbCgpO1xuICAgIHZhciAkY2FyZHMgPSAkKCcuYWN0aXZpdHkuY29sJykuc2hvdygpO1xuICAgIC8vIFJlbW92ZSBhY3Rpdml0aWVzIHdob2VzIHR5cGUgZG9lc24ndCBtYXRjaCB0aGUgY29uZmlndXJlZCBhY3Rpdml0eSB0eXBlLlxuICAgICRjYXJkcy5maWx0ZXIoZnVuY3Rpb24gKGksIGVsKSB7XG4gICAgICAgIHJldHVybiAkKGVsKS5kYXRhKCdhY3Rpdml0eS10eXBlJykgIT0gdHlwZTtcbiAgICB9KS5oaWRlKCk7XG4gICAgaWYgKHEubGVuZ3RoID4gMCkge1xuICAgICAgICAvLyBSZW1vdmUgYWN0aXZpdGllcyB3aG9zZSB0aXRsZSBkb2Vzbid0IG1hdGNoIHRoZSBxdWVyeS5cbiAgICAgICAgJGNhcmRzLmZpbHRlcihmdW5jdGlvbiAoaSwgZWwpIHtcbiAgICAgICAgICAgIHJldHVybiAkKGVsKS5maW5kKCcuY2FyZC10aXRsZScpLnRleHQoKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YocS50b0xvd2VyQ2FzZSgpKSA8IDAgJiYgcSAmJiBxLmxlbmd0aCA+IDA7XG4gICAgICAgIH0pLmhpZGUoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIFJlbW92ZSBhY3Rpdml0aWVzIHdob3NlIGNhdGVnb3J5IGRvZXNuJ3QgbWF0Y2ggdGhlIHNlbGVjdGVkIG9uZS5cbiAgICAgICAgJGNhcmRzLmZpbHRlcihmdW5jdGlvbiAoaSwgZWwpIHtcbiAgICAgICAgICAgIHJldHVybiAkKGVsKS5kYXRhKCdjYXRlZ29yeScpLnRvTG93ZXJDYXNlKCkgIT0gY2F0ZWdvcnkudG9Mb3dlckNhc2UoKSAmJiBjYXRlZ29yeS50b0xvd2VyQ2FzZSgpICE9ICdhbGwnO1xuICAgICAgICB9KS5oaWRlKCk7XG4gICAgfVxuICAgIC8vIFNob3cgb3IgaGlkZSBjYXRlZ29yaWVzIGJhc2VkIG9uIHdoZXRoZXIgdGhlcmUgYXJlIGFueSBhdmFpbGFibGUgYWN0aXZpdGllcy5cbiAgICAkKCcuYWN0aXZpdHktcGlja2VyLWNhdGVnb3JpZXMgW2RhdGEtY2F0ZWdvcnldJykuZWFjaChmdW5jdGlvbiAoaSwgZWwpIHtcbiAgICAgICAgdmFyIGNhdGVnb3J5TGlzdEl0ZW0gPSAkKGVsKTtcbiAgICAgICAgdmFyIGNhdGVnb3J5ID0gY2F0ZWdvcnlMaXN0SXRlbS5kYXRhKCdjYXRlZ29yeScpO1xuICAgICAgICAvLyBDb3VudCBudW1iZXIgb2YgYWN0aXZpdGllcyB3aXRoaW4gdGhpcyBjYXRlZ29yeSBhbmQgZm9yIHRoZSBzcGVjaWZpZWQgYWN0aXZpdHkgdHlwZSAoRXZlbnQgb3IgVGFzaykuXG4gICAgICAgIHZhciBhY3Rpdml0eUNvdW50ID0gJChcIi5hY3Rpdml0eS5jb2xbZGF0YS1jYXRlZ29yeT0nXCIuY29uY2F0KGNhdGVnb3J5LCBcIiddW2RhdGEtYWN0aXZpdHktdHlwZT0nXCIpLmNvbmNhdCh0eXBlLCBcIiddXCIpKS5sZW5ndGg7XG4gICAgICAgIGFjdGl2aXR5Q291bnQgPT0gMCA/IGNhdGVnb3J5TGlzdEl0ZW0uaGlkZSgpIDogY2F0ZWdvcnlMaXN0SXRlbS5zaG93KCk7XG4gICAgfSk7XG59O1xuJChmdW5jdGlvbiAoKSB7XG4gICAgJCgnLmFjdGl2aXR5LXBpY2tlci1jYXRlZ29yaWVzJykub24oJ2NsaWNrJywgJy5uYXYtbGluaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGFwcGx5RmlsdGVyKCQoZS50YXJnZXQpLmF0dHIoJ2hyZWYnKS5zdWJzdHIoMSksIG51bGwpO1xuICAgIH0pO1xuICAgICQoJy5tb2RhbC1hY3Rpdml0aWVzIGlucHV0W3R5cGU9c2VhcmNoXScpLm9uKCdrZXl1cCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGFwcGx5RmlsdGVyKG51bGwsICQoZS50YXJnZXQpLnZhbCgpKTtcbiAgICB9KTtcbiAgICAkKCcjYWN0aXZpdHktcGlja2VyJykub24oJ3Nob3cuYnMubW9kYWwnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdmFyIG1vZGFsRXZlbnQgPSBldmVudDtcbiAgICAgICAgdmFyIGJ1dHRvbiA9ICQobW9kYWxFdmVudC5yZWxhdGVkVGFyZ2V0KTsgLy8gQnV0dG9uIHRoYXQgdHJpZ2dlcmVkIHRoZSBtb2RhbC5cbiAgICAgICAgdmFyIHRpdGxlID0gYnV0dG9uLmRhdGEoJ3BpY2tlci10aXRsZScpO1xuICAgICAgICB2YXIgdHlwZSA9IGJ1dHRvbi5kYXRhKCdhY3Rpdml0eS10eXBlJyk7XG4gICAgICAgIHZhciBtb2RhbCA9ICQodGhpcyk7XG4gICAgICAgIG1vZGFsLmZpbmQoJ1tocmVmPVwiI2FsbFwiXScpLmNsaWNrKCk7XG4gICAgICAgIG1vZGFsLmZpbmQoJy5tb2RhbC10aXRsZScpLnRleHQodGl0bGUpO1xuICAgICAgICBtb2RhbC5kYXRhKCdhY3Rpdml0eS10eXBlJywgdHlwZSk7XG4gICAgICAgIGFwcGx5RmlsdGVyKG51bGwsIG51bGwpO1xuICAgIH0pO1xufSk7XG4iLCIvLy88cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi8uLi9Bc3NldHMvTGliL2pxdWVyeS90eXBpbmdzLmQudHNcIiAvPlxyXG5cclxuJCgoKSA9PiB7XHJcbiAgICBjb25zdCBnZW5lcmF0ZVdvcmtmbG93VXJsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0IHdvcmtmbG93VHlwZUlkOiBzdHJpbmcgPSAkKCdbZGF0YS13b3JrZmxvdy10eXBlLWlkXScpLmRhdGEoJ3dvcmtmbG93LXR5cGUtaWQnKTtcclxuICAgICAgICBjb25zdCBhY3Rpdml0eUlkOiBzdHJpbmcgPSAkKCdbZGF0YS1hY3Rpdml0eS1pZF0nKS5kYXRhKCdhY3Rpdml0eS1pZCcpO1xyXG4gICAgICAgIHZhciB0b2tlbkxpZmVTcGFuID0gJCgnI3Rva2VuLWxpZmVzcGFuJykudmFsKCk7XHJcbiAgICAgICAgY29uc3QgZ2VuZXJhdGVVcmw6IHN0cmluZyA9ICQoJ1tkYXRhLWdlbmVyYXRlLXVybF0nKS5kYXRhKCdnZW5lcmF0ZS11cmwnKSArIGA/d29ya2Zsb3dUeXBlSWQ9JHt3b3JrZmxvd1R5cGVJZH0mYWN0aXZpdHlJZD0ke2FjdGl2aXR5SWR9JnRva2VuTGlmZVNwYW49JHt0b2tlbkxpZmVTcGFufWA7XHJcbiAgICAgICAgY29uc3QgYW50aWZvcmdlcnlIZWFkZXJOYW1lOiBzdHJpbmcgPSAkKCdbZGF0YS1hbnRpZm9yZ2VyeS1oZWFkZXItbmFtZV0nKS5kYXRhKCdhbnRpZm9yZ2VyeS1oZWFkZXItbmFtZScpO1xyXG4gICAgICAgIGNvbnN0IGFudGlmb3JnZXJ5VG9rZW46IHN0cmluZyA9ICQoJ1tkYXRhLWFudGlmb3JnZXJ5LXRva2VuXScpLmRhdGEoJ2FudGlmb3JnZXJ5LXRva2VuJyk7XHJcbiAgICAgICAgY29uc3QgaGVhZGVyczogYW55ID0ge307XHJcblxyXG4gICAgICAgIGhlYWRlcnNbYW50aWZvcmdlcnlIZWFkZXJOYW1lXSA9IGFudGlmb3JnZXJ5VG9rZW47XHJcblxyXG4gICAgICAgICQucG9zdCh7XHJcbiAgICAgICAgICAgIHVybDogZ2VuZXJhdGVVcmwsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnNcclxuICAgICAgICB9KS5kb25lKHVybCA9PiB7XHJcbiAgICAgICAgICAgICQoJyN3b3JrZmxvdy11cmwtdGV4dCcpLnZhbCh1cmwpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICAkKCcjZ2VuZXJhdGUtdXJsLWJ1dHRvbicpLm9uKCdjbGljaycsIGUgPT4ge1xyXG4gICAgICAgIGdlbmVyYXRlV29ya2Zsb3dVcmwoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGlmICgkKCcjd29ya2Zsb3ctdXJsLXRleHQnKS52YWwoKSA9PSAnJykge1xyXG4gICAgICAgIGdlbmVyYXRlV29ya2Zsb3dVcmwoKTtcclxuICAgIH1cclxufSk7XHJcbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uLy4uL0Fzc2V0cy9MaWIvanF1ZXJ5L3R5cGluZ3MuZC50c1wiIC8+XG4kKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZ2VuZXJhdGVXb3JrZmxvd1VybCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHdvcmtmbG93VHlwZUlkID0gJCgnW2RhdGEtd29ya2Zsb3ctdHlwZS1pZF0nKS5kYXRhKCd3b3JrZmxvdy10eXBlLWlkJyk7XG4gICAgICAgIHZhciBhY3Rpdml0eUlkID0gJCgnW2RhdGEtYWN0aXZpdHktaWRdJykuZGF0YSgnYWN0aXZpdHktaWQnKTtcbiAgICAgICAgdmFyIHRva2VuTGlmZVNwYW4gPSAkKCcjdG9rZW4tbGlmZXNwYW4nKS52YWwoKTtcbiAgICAgICAgdmFyIGdlbmVyYXRlVXJsID0gJCgnW2RhdGEtZ2VuZXJhdGUtdXJsXScpLmRhdGEoJ2dlbmVyYXRlLXVybCcpICsgXCI/d29ya2Zsb3dUeXBlSWQ9XCIuY29uY2F0KHdvcmtmbG93VHlwZUlkLCBcIiZhY3Rpdml0eUlkPVwiKS5jb25jYXQoYWN0aXZpdHlJZCwgXCImdG9rZW5MaWZlU3Bhbj1cIikuY29uY2F0KHRva2VuTGlmZVNwYW4pO1xuICAgICAgICB2YXIgYW50aWZvcmdlcnlIZWFkZXJOYW1lID0gJCgnW2RhdGEtYW50aWZvcmdlcnktaGVhZGVyLW5hbWVdJykuZGF0YSgnYW50aWZvcmdlcnktaGVhZGVyLW5hbWUnKTtcbiAgICAgICAgdmFyIGFudGlmb3JnZXJ5VG9rZW4gPSAkKCdbZGF0YS1hbnRpZm9yZ2VyeS10b2tlbl0nKS5kYXRhKCdhbnRpZm9yZ2VyeS10b2tlbicpO1xuICAgICAgICB2YXIgaGVhZGVycyA9IHt9O1xuICAgICAgICBoZWFkZXJzW2FudGlmb3JnZXJ5SGVhZGVyTmFtZV0gPSBhbnRpZm9yZ2VyeVRva2VuO1xuICAgICAgICAkLnBvc3Qoe1xuICAgICAgICAgICAgdXJsOiBnZW5lcmF0ZVVybCxcbiAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAodXJsKSB7XG4gICAgICAgICAgICAkKCcjd29ya2Zsb3ctdXJsLXRleHQnKS52YWwodXJsKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAkKCcjZ2VuZXJhdGUtdXJsLWJ1dHRvbicpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGdlbmVyYXRlV29ya2Zsb3dVcmwoKTtcbiAgICB9KTtcbiAgICBpZiAoJCgnI3dvcmtmbG93LXVybC10ZXh0JykudmFsKCkgPT0gJycpIHtcbiAgICAgICAgZ2VuZXJhdGVXb3JrZmxvd1VybCgpO1xuICAgIH1cbn0pO1xuIiwiLy8vPHJlZmVyZW5jZSBwYXRoPScuLi9MaWIvanF1ZXJ5L3R5cGluZ3MuZC50cycgLz5cclxuLy8vPHJlZmVyZW5jZSBwYXRoPScuLi9MaWIvanNwbHVtYi90eXBpbmdzLmQudHMnIC8+XHJcbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi93b3JrZmxvdy1tb2RlbHMudHMnIC8+XHJcblxyXG5hYnN0cmFjdCBjbGFzcyBXb3JrZmxvd0NhbnZhcyB7XHJcbiAgICBwcml2YXRlIG1pbkNhbnZhc0hlaWdodDogbnVtYmVyID0gNDAwO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBjb250YWluZXI6IEhUTUxFbGVtZW50LCBwcm90ZWN0ZWQgd29ya2Zsb3dUeXBlOiBXb3JrZmxvd3MuV29ya2Zsb3dUeXBlKSB7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGdldEFjdGl2aXR5RWxlbWVudHMgPSAoKTogSlF1ZXJ5ID0+IHtcclxuICAgICAgICByZXR1cm4gJCh0aGlzLmNvbnRhaW5lcikuZmluZCgnLmFjdGl2aXR5Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGdldERlZmF1bHRzID0gKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIEFuY2hvcjogXCJDb250aW51b3VzXCIsXHJcbiAgICAgICAgICAgIERyYWdPcHRpb25zOiB7IGN1cnNvcjogJ3BvaW50ZXInLCB6SW5kZXg6IDIwMDAgfSxcclxuICAgICAgICAgICAgRW5kcG9pbnRTdHlsZXM6IFt7IGZpbGxTdHlsZTogJyMyMjU1ODgnIH1dLFxyXG4gICAgICAgICAgICBFbmRwb2ludHM6IFtbXCJEb3RcIiwgeyByYWRpdXM6IDcgfV0sIFtcIkJsYW5rXCJdXSxcclxuICAgICAgICAgICAgQ29ubmVjdGlvbk92ZXJsYXlzOiBbXHJcbiAgICAgICAgICAgICAgICBbXCJBcnJvd1wiLCB7IHdpZHRoOiAxMiwgbGVuZ3RoOiAxMiwgbG9jYXRpb246IC01IH1dLFxyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICBDb25uZWN0b3JaSW5kZXg6IDVcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHByb3RlY3RlZCBjcmVhdGVKc1BsdW1iSW5zdGFuY2UgPSAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGpzUGx1bWIuZ2V0SW5zdGFuY2Uoe1xyXG4gICAgICAgICAgICBEcmFnT3B0aW9uczogeyBjdXJzb3I6ICdwb2ludGVyJywgekluZGV4OiAyMDAwIH0sXHJcbiAgICAgICAgICAgIENvbm5lY3Rpb25PdmVybGF5czogW1xyXG4gICAgICAgICAgICAgICAgWydBcnJvdycsIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogMSxcclxuICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxMSxcclxuICAgICAgICAgICAgICAgICAgICBsZW5ndGg6IDExXHJcbiAgICAgICAgICAgICAgICB9XSxcclxuICAgICAgICAgICAgICAgIFsnTGFiZWwnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IDAuNSxcclxuICAgICAgICAgICAgICAgICAgICBpZDogJ2xhYmVsJyxcclxuICAgICAgICAgICAgICAgICAgICBjc3NDbGFzczogJ2Nvbm5lY3Rpb24tbGFiZWwnXHJcbiAgICAgICAgICAgICAgICB9XVxyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICBDb250YWluZXI6IHRoaXMuY29udGFpbmVyXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIHByb3RlY3RlZCBnZXRFbmRwb2ludENvbG9yID0gKGFjdGl2aXR5OiBXb3JrZmxvd3MuQWN0aXZpdHkpID0+IHtcclxuICAgICAgICByZXR1cm4gYWN0aXZpdHkuaXNCbG9ja2luZyB8fCBhY3Rpdml0eS5pc1N0YXJ0ID8gJyM3YWIwMmMnIDogYWN0aXZpdHkuaXNFdmVudCA/ICcjM2E4YWNkJyA6ICcjN2FiMDJjJztcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgZ2V0U291cmNlRW5kcG9pbnRPcHRpb25zID0gKGFjdGl2aXR5OiBXb3JrZmxvd3MuQWN0aXZpdHksIG91dGNvbWU6IFdvcmtmbG93cy5PdXRjb21lKTogRW5kcG9pbnRPcHRpb25zID0+IHtcclxuICAgICAgICAvLyBUaGUgZGVmaW5pdGlvbiBvZiBzb3VyY2UgZW5kcG9pbnRzLlxyXG4gICAgICAgIGNvbnN0IHBhaW50Q29sb3IgPSB0aGlzLmdldEVuZHBvaW50Q29sb3IoYWN0aXZpdHkpO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGVuZHBvaW50OiAnRG90JyxcclxuICAgICAgICAgICAgYW5jaG9yOiAnQ29udGludW91cycsXHJcbiAgICAgICAgICAgIHBhaW50U3R5bGU6IHtcclxuICAgICAgICAgICAgICAgIHN0cm9rZTogcGFpbnRDb2xvcixcclxuICAgICAgICAgICAgICAgIGZpbGw6IHBhaW50Q29sb3IsXHJcbiAgICAgICAgICAgICAgICByYWRpdXM6IDcsXHJcbiAgICAgICAgICAgICAgICBzdHJva2VXaWR0aDogMVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBpc1NvdXJjZTogdHJ1ZSxcclxuICAgICAgICAgICAgY29ubmVjdG9yOiBbJ0Zsb3djaGFydCcsIHsgc3R1YjogWzQwLCA2MF0sIGdhcDogMCwgY29ybmVyUmFkaXVzOiA1LCBhbHdheXNSZXNwZWN0U3R1YnM6IHRydWUgfV0sXHJcbiAgICAgICAgICAgIGNvbm5lY3RvclN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICBzdHJva2VXaWR0aDogMixcclxuICAgICAgICAgICAgICAgIHN0cm9rZTogJyM5OTk5OTknLFxyXG4gICAgICAgICAgICAgICAgam9pbnN0eWxlOiAncm91bmQnLFxyXG4gICAgICAgICAgICAgICAgb3V0bGluZVN0cm9rZTogJ3doaXRlJyxcclxuICAgICAgICAgICAgICAgIG91dGxpbmVXaWR0aDogMlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBob3ZlclBhaW50U3R5bGU6IHtcclxuICAgICAgICAgICAgICAgIGZpbGw6ICcjMjE2NDc3JyxcclxuICAgICAgICAgICAgICAgIHN0cm9rZTogJyMyMTY0NzcnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNvbm5lY3RvckhvdmVyU3R5bGU6IHtcclxuICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAzLFxyXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiAnIzIxNjQ3NycsXHJcbiAgICAgICAgICAgICAgICBvdXRsaW5lV2lkdGg6IDUsXHJcbiAgICAgICAgICAgICAgICBvdXRsaW5lU3Ryb2tlOiAnd2hpdGUnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNvbm5lY3Rvck92ZXJsYXlzOiBbWydMYWJlbCcsIHsgbG9jYXRpb246IFszLCAtMS41XSwgY3NzQ2xhc3M6ICdlbmRwb2ludFNvdXJjZUxhYmVsJyB9XV0sXHJcbiAgICAgICAgICAgIGRyYWdPcHRpb25zOiB7fSxcclxuICAgICAgICAgICAgdXVpZDogYCR7YWN0aXZpdHkuaWR9LSR7b3V0Y29tZS5uYW1lfWAsXHJcbiAgICAgICAgICAgIHBhcmFtZXRlcnM6IHtcclxuICAgICAgICAgICAgICAgIG91dGNvbWU6IG91dGNvbWVcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIHByb3RlY3RlZCBnZXRBY3Rpdml0eSA9IGZ1bmN0aW9uIChpZDogc3RyaW5nLCBhY3Rpdml0aWVzOiBBcnJheTxXb3JrZmxvd3MuQWN0aXZpdHk+ID0gbnVsbCk6IFdvcmtmbG93cy5BY3Rpdml0eSB7XHJcbiAgICAgICAgaWYgKCFhY3Rpdml0aWVzKSB7XHJcbiAgICAgICAgICAgIGFjdGl2aXRpZXMgPSB0aGlzLndvcmtmbG93VHlwZS5hY3Rpdml0aWVzO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gJC5ncmVwKGFjdGl2aXRpZXMsICh4OiBXb3JrZmxvd3MuQWN0aXZpdHkpID0+IHguaWQgPT09IGlkKVswXTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgdXBkYXRlQ29ubmVjdGlvbnMgPSAocGx1bWJlcjoganNQbHVtYkluc3RhbmNlKSA9PiB7XHJcbiAgICAgICAgdmFyIHdvcmtmbG93SWQ6IG51bWJlciA9IHRoaXMud29ya2Zsb3dUeXBlLmlkO1xyXG5cclxuICAgICAgICAvLyBDb25uZWN0IGFjdGl2aXRpZXMuXHJcbiAgICAgICAgZm9yIChsZXQgdHJhbnNpdGlvbk1vZGVsIG9mIHRoaXMud29ya2Zsb3dUeXBlLnRyYW5zaXRpb25zKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNvdXJjZUVuZHBvaW50VXVpZDogc3RyaW5nID0gYCR7dHJhbnNpdGlvbk1vZGVsLnNvdXJjZUFjdGl2aXR5SWR9LSR7dHJhbnNpdGlvbk1vZGVsLnNvdXJjZU91dGNvbWVOYW1lfWA7XHJcbiAgICAgICAgICAgIGNvbnN0IHNvdXJjZUVuZHBvaW50OiBFbmRwb2ludCA9IHBsdW1iZXIuZ2V0RW5kcG9pbnQoc291cmNlRW5kcG9pbnRVdWlkKTtcclxuICAgICAgICAgICAgY29uc3QgZGVzdGluYXRpb25FbGVtZW50SWQ6IHN0cmluZyA9IGBhY3Rpdml0eS0ke3dvcmtmbG93SWR9LSR7dHJhbnNpdGlvbk1vZGVsLmRlc3RpbmF0aW9uQWN0aXZpdHlJZH1gO1xyXG5cclxuICAgICAgICAgICAgcGx1bWJlci5jb25uZWN0KHtcclxuICAgICAgICAgICAgICAgIHNvdXJjZTogc291cmNlRW5kcG9pbnQsXHJcbiAgICAgICAgICAgICAgICB0YXJnZXQ6IGRlc3RpbmF0aW9uRWxlbWVudElkXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgdXBkYXRlQ2FudmFzSGVpZ2h0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0ICRjb250YWluZXIgPSAkKHRoaXMuY29udGFpbmVyKTtcclxuXHJcbiAgICAgICAgLy8gR2V0IHRoZSBhY3Rpdml0eSBlbGVtZW50IHdpdGggdGhlIGhpZ2hlc3QgWSBjb29yZGluYXRlLlxyXG4gICAgICAgIGNvbnN0ICRhY3Rpdml0eUVsZW1lbnRzID0gJGNvbnRhaW5lci5maW5kKFwiLmFjdGl2aXR5XCIpO1xyXG4gICAgICAgIGxldCBjdXJyZW50RWxlbWVudFRvcCA9IDA7XHJcbiAgICAgICAgbGV0IGN1cnJlbnRBY3Rpdml0eUhlaWdodCA9IDA7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGFjdGl2aXR5RWxlbWVudCBvZiAkYWN0aXZpdHlFbGVtZW50cy50b0FycmF5KCkpIHtcclxuICAgICAgICAgICAgY29uc3QgJGFjdGl2aXR5RWxlbWVudCA9ICQoYWN0aXZpdHlFbGVtZW50KTtcclxuICAgICAgICAgICAgY29uc3QgdG9wID0gJGFjdGl2aXR5RWxlbWVudC5wb3NpdGlvbigpLnRvcDtcclxuXHJcbiAgICAgICAgICAgIGlmICh0b3AgPiBjdXJyZW50RWxlbWVudFRvcCkge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudEVsZW1lbnRUb3AgPSB0b3A7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50QWN0aXZpdHlIZWlnaHQgPSAkYWN0aXZpdHlFbGVtZW50LmhlaWdodCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgbmV3Q2FudmFzSGVpZ2h0ID0gY3VycmVudEVsZW1lbnRUb3AgKyBjdXJyZW50QWN0aXZpdHlIZWlnaHQ7XHJcbiAgICAgICAgY29uc3QgZWxlbWVudEJvdHRvbSA9IGN1cnJlbnRFbGVtZW50VG9wICsgY3VycmVudEFjdGl2aXR5SGVpZ2h0O1xyXG4gICAgICAgIGNvbnN0IHN0cmV0Y2hWYWx1ZSA9IDEwMDtcclxuXHJcbiAgICAgICAgaWYgKG5ld0NhbnZhc0hlaWdodCAtIGVsZW1lbnRCb3R0b20gPD0gc3RyZXRjaFZhbHVlKSB7XHJcbiAgICAgICAgICAgIG5ld0NhbnZhc0hlaWdodCArPSBzdHJldGNoVmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY29udGFpbmVyLmhlaWdodChNYXRoLm1heCh0aGlzLm1pbkNhbnZhc0hlaWdodCwgbmV3Q2FudmFzSGVpZ2h0KSk7XHJcbiAgICB9O1xyXG59XHJcbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pxdWVyeS90eXBpbmdzLmQudHMnIC8+XG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qc3BsdW1iL3R5cGluZ3MuZC50cycgLz5cbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi93b3JrZmxvdy1tb2RlbHMudHMnIC8+XG52YXIgV29ya2Zsb3dDYW52YXMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gV29ya2Zsb3dDYW52YXMoY29udGFpbmVyLCB3b3JrZmxvd1R5cGUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgICAgIHRoaXMud29ya2Zsb3dUeXBlID0gd29ya2Zsb3dUeXBlO1xuICAgICAgICB0aGlzLm1pbkNhbnZhc0hlaWdodCA9IDQwMDtcbiAgICAgICAgdGhpcy5nZXRBY3Rpdml0eUVsZW1lbnRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICQoX3RoaXMuY29udGFpbmVyKS5maW5kKCcuYWN0aXZpdHknKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5nZXREZWZhdWx0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgQW5jaG9yOiBcIkNvbnRpbnVvdXNcIixcbiAgICAgICAgICAgICAgICBEcmFnT3B0aW9uczogeyBjdXJzb3I6ICdwb2ludGVyJywgekluZGV4OiAyMDAwIH0sXG4gICAgICAgICAgICAgICAgRW5kcG9pbnRTdHlsZXM6IFt7IGZpbGxTdHlsZTogJyMyMjU1ODgnIH1dLFxuICAgICAgICAgICAgICAgIEVuZHBvaW50czogW1tcIkRvdFwiLCB7IHJhZGl1czogNyB9XSwgW1wiQmxhbmtcIl1dLFxuICAgICAgICAgICAgICAgIENvbm5lY3Rpb25PdmVybGF5czogW1xuICAgICAgICAgICAgICAgICAgICBbXCJBcnJvd1wiLCB7IHdpZHRoOiAxMiwgbGVuZ3RoOiAxMiwgbG9jYXRpb246IC01IH1dLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgQ29ubmVjdG9yWkluZGV4OiA1XG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNyZWF0ZUpzUGx1bWJJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBqc1BsdW1iLmdldEluc3RhbmNlKHtcbiAgICAgICAgICAgICAgICBEcmFnT3B0aW9uczogeyBjdXJzb3I6ICdwb2ludGVyJywgekluZGV4OiAyMDAwIH0sXG4gICAgICAgICAgICAgICAgQ29ubmVjdGlvbk92ZXJsYXlzOiBbXG4gICAgICAgICAgICAgICAgICAgIFsnQXJyb3cnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoOiAxMVxuICAgICAgICAgICAgICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICAgICAgICAgIFsnTGFiZWwnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IDAuNSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogJ2xhYmVsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3NDbGFzczogJ2Nvbm5lY3Rpb24tbGFiZWwnXG4gICAgICAgICAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgQ29udGFpbmVyOiBfdGhpcy5jb250YWluZXJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmdldEVuZHBvaW50Q29sb3IgPSBmdW5jdGlvbiAoYWN0aXZpdHkpIHtcbiAgICAgICAgICAgIHJldHVybiBhY3Rpdml0eS5pc0Jsb2NraW5nIHx8IGFjdGl2aXR5LmlzU3RhcnQgPyAnIzdhYjAyYycgOiBhY3Rpdml0eS5pc0V2ZW50ID8gJyMzYThhY2QnIDogJyM3YWIwMmMnO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmdldFNvdXJjZUVuZHBvaW50T3B0aW9ucyA9IGZ1bmN0aW9uIChhY3Rpdml0eSwgb3V0Y29tZSkge1xuICAgICAgICAgICAgLy8gVGhlIGRlZmluaXRpb24gb2Ygc291cmNlIGVuZHBvaW50cy5cbiAgICAgICAgICAgIHZhciBwYWludENvbG9yID0gX3RoaXMuZ2V0RW5kcG9pbnRDb2xvcihhY3Rpdml0eSk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGVuZHBvaW50OiAnRG90JyxcbiAgICAgICAgICAgICAgICBhbmNob3I6ICdDb250aW51b3VzJyxcbiAgICAgICAgICAgICAgICBwYWludFN0eWxlOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZTogcGFpbnRDb2xvcixcbiAgICAgICAgICAgICAgICAgICAgZmlsbDogcGFpbnRDb2xvcixcbiAgICAgICAgICAgICAgICAgICAgcmFkaXVzOiA3LFxuICAgICAgICAgICAgICAgICAgICBzdHJva2VXaWR0aDogMVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaXNTb3VyY2U6IHRydWUsXG4gICAgICAgICAgICAgICAgY29ubmVjdG9yOiBbJ0Zsb3djaGFydCcsIHsgc3R1YjogWzQwLCA2MF0sIGdhcDogMCwgY29ybmVyUmFkaXVzOiA1LCBhbHdheXNSZXNwZWN0U3R1YnM6IHRydWUgfV0sXG4gICAgICAgICAgICAgICAgY29ubmVjdG9yU3R5bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZTogJyM5OTk5OTknLFxuICAgICAgICAgICAgICAgICAgICBqb2luc3R5bGU6ICdyb3VuZCcsXG4gICAgICAgICAgICAgICAgICAgIG91dGxpbmVTdHJva2U6ICd3aGl0ZScsXG4gICAgICAgICAgICAgICAgICAgIG91dGxpbmVXaWR0aDogMlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaG92ZXJQYWludFN0eWxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGw6ICcjMjE2NDc3JyxcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlOiAnIzIxNjQ3NydcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbm5lY3RvckhvdmVyU3R5bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDMsXG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZTogJyMyMTY0NzcnLFxuICAgICAgICAgICAgICAgICAgICBvdXRsaW5lV2lkdGg6IDUsXG4gICAgICAgICAgICAgICAgICAgIG91dGxpbmVTdHJva2U6ICd3aGl0ZSdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbm5lY3Rvck92ZXJsYXlzOiBbWydMYWJlbCcsIHsgbG9jYXRpb246IFszLCAtMS41XSwgY3NzQ2xhc3M6ICdlbmRwb2ludFNvdXJjZUxhYmVsJyB9XV0sXG4gICAgICAgICAgICAgICAgZHJhZ09wdGlvbnM6IHt9LFxuICAgICAgICAgICAgICAgIHV1aWQ6IFwiXCIuY29uY2F0KGFjdGl2aXR5LmlkLCBcIi1cIikuY29uY2F0KG91dGNvbWUubmFtZSksXG4gICAgICAgICAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgICAgICAgICAgICBvdXRjb21lOiBvdXRjb21lXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5nZXRBY3Rpdml0eSA9IGZ1bmN0aW9uIChpZCwgYWN0aXZpdGllcykge1xuICAgICAgICAgICAgaWYgKGFjdGl2aXRpZXMgPT09IHZvaWQgMCkgeyBhY3Rpdml0aWVzID0gbnVsbDsgfVxuICAgICAgICAgICAgaWYgKCFhY3Rpdml0aWVzKSB7XG4gICAgICAgICAgICAgICAgYWN0aXZpdGllcyA9IHRoaXMud29ya2Zsb3dUeXBlLmFjdGl2aXRpZXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJC5ncmVwKGFjdGl2aXRpZXMsIGZ1bmN0aW9uICh4KSB7IHJldHVybiB4LmlkID09PSBpZDsgfSlbMF07XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudXBkYXRlQ29ubmVjdGlvbnMgPSBmdW5jdGlvbiAocGx1bWJlcikge1xuICAgICAgICAgICAgdmFyIHdvcmtmbG93SWQgPSBfdGhpcy53b3JrZmxvd1R5cGUuaWQ7XG4gICAgICAgICAgICAvLyBDb25uZWN0IGFjdGl2aXRpZXMuXG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gX3RoaXMud29ya2Zsb3dUeXBlLnRyYW5zaXRpb25zOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgIHZhciB0cmFuc2l0aW9uTW9kZWwgPSBfYVtfaV07XG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZUVuZHBvaW50VXVpZCA9IFwiXCIuY29uY2F0KHRyYW5zaXRpb25Nb2RlbC5zb3VyY2VBY3Rpdml0eUlkLCBcIi1cIikuY29uY2F0KHRyYW5zaXRpb25Nb2RlbC5zb3VyY2VPdXRjb21lTmFtZSk7XG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZUVuZHBvaW50ID0gcGx1bWJlci5nZXRFbmRwb2ludChzb3VyY2VFbmRwb2ludFV1aWQpO1xuICAgICAgICAgICAgICAgIHZhciBkZXN0aW5hdGlvbkVsZW1lbnRJZCA9IFwiYWN0aXZpdHktXCIuY29uY2F0KHdvcmtmbG93SWQsIFwiLVwiKS5jb25jYXQodHJhbnNpdGlvbk1vZGVsLmRlc3RpbmF0aW9uQWN0aXZpdHlJZCk7XG4gICAgICAgICAgICAgICAgcGx1bWJlci5jb25uZWN0KHtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlOiBzb3VyY2VFbmRwb2ludCxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0OiBkZXN0aW5hdGlvbkVsZW1lbnRJZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnVwZGF0ZUNhbnZhc0hlaWdodCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciAkY29udGFpbmVyID0gJCh0aGlzLmNvbnRhaW5lcik7XG4gICAgICAgICAgICAvLyBHZXQgdGhlIGFjdGl2aXR5IGVsZW1lbnQgd2l0aCB0aGUgaGlnaGVzdCBZIGNvb3JkaW5hdGUuXG4gICAgICAgICAgICB2YXIgJGFjdGl2aXR5RWxlbWVudHMgPSAkY29udGFpbmVyLmZpbmQoXCIuYWN0aXZpdHlcIik7XG4gICAgICAgICAgICB2YXIgY3VycmVudEVsZW1lbnRUb3AgPSAwO1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRBY3Rpdml0eUhlaWdodCA9IDA7XG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gJGFjdGl2aXR5RWxlbWVudHMudG9BcnJheSgpOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgIHZhciBhY3Rpdml0eUVsZW1lbnQgPSBfYVtfaV07XG4gICAgICAgICAgICAgICAgdmFyICRhY3Rpdml0eUVsZW1lbnQgPSAkKGFjdGl2aXR5RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdmFyIHRvcF8xID0gJGFjdGl2aXR5RWxlbWVudC5wb3NpdGlvbigpLnRvcDtcbiAgICAgICAgICAgICAgICBpZiAodG9wXzEgPiBjdXJyZW50RWxlbWVudFRvcCkge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50RWxlbWVudFRvcCA9IHRvcF8xO1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50QWN0aXZpdHlIZWlnaHQgPSAkYWN0aXZpdHlFbGVtZW50LmhlaWdodCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBuZXdDYW52YXNIZWlnaHQgPSBjdXJyZW50RWxlbWVudFRvcCArIGN1cnJlbnRBY3Rpdml0eUhlaWdodDtcbiAgICAgICAgICAgIHZhciBlbGVtZW50Qm90dG9tID0gY3VycmVudEVsZW1lbnRUb3AgKyBjdXJyZW50QWN0aXZpdHlIZWlnaHQ7XG4gICAgICAgICAgICB2YXIgc3RyZXRjaFZhbHVlID0gMTAwO1xuICAgICAgICAgICAgaWYgKG5ld0NhbnZhc0hlaWdodCAtIGVsZW1lbnRCb3R0b20gPD0gc3RyZXRjaFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgbmV3Q2FudmFzSGVpZ2h0ICs9IHN0cmV0Y2hWYWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRjb250YWluZXIuaGVpZ2h0KE1hdGgubWF4KHRoaXMubWluQ2FudmFzSGVpZ2h0LCBuZXdDYW52YXNIZWlnaHQpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIFdvcmtmbG93Q2FudmFzO1xufSgpKTtcbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pxdWVyeS90eXBpbmdzLmQudHMnIC8+XHJcbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pzcGx1bWIvdHlwaW5ncy5kLnRzJyAvPlxyXG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4vd29ya2Zsb3ctbW9kZWxzLnRzJyAvPlxyXG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4vd29ya2Zsb3ctY2FudmFzLnRzJyAvPlxyXG5cclxuLy8gVE9ETzogUmUtaW1wbGVtZW50IHRoaXMgdXNpbmcgYSBNVlZNIGFwcHJvYWNoLlxyXG5jbGFzcyBXb3JrZmxvd0VkaXRvciBleHRlbmRzIFdvcmtmbG93Q2FudmFzIHtcclxuICAgIHByaXZhdGUganNQbHVtYkluc3RhbmNlOiBqc1BsdW1iSW5zdGFuY2U7XHJcbiAgICBwcml2YXRlIGlzUG9wb3ZlclZpc2libGU6IGJvb2xlYW47XHJcbiAgICBwcml2YXRlIGhhc0RyYWdnZWQ6IGJvb2xlYW47XHJcbiAgICBwcml2YXRlIGRyYWdTdGFydDogSlF1ZXJ5LkNvb3JkaW5hdGVzO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBjb250YWluZXI6IEhUTUxFbGVtZW50LCBwcm90ZWN0ZWQgd29ya2Zsb3dUeXBlOiBXb3JrZmxvd3MuV29ya2Zsb3dUeXBlLCBwcml2YXRlIGRlbGV0ZUFjdGl2aXR5UHJvbXB0OiBzdHJpbmcsIHByaXZhdGUgbG9jYWxJZDogc3RyaW5nLCBsb2FkTG9jYWxTdGF0ZTogYm9vbGVhbikge1xyXG4gICAgICAgIHN1cGVyKGNvbnRhaW5lciwgd29ya2Zsb3dUeXBlKTtcclxuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAganNQbHVtYi5yZWFkeSgoKSA9PiB7XHJcbiAgICAgICAgICAgIGpzUGx1bWIuaW1wb3J0RGVmYXVsdHModGhpcy5nZXREZWZhdWx0cygpKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHBsdW1iZXIgPSB0aGlzLmNyZWF0ZUpzUGx1bWJJbnN0YW5jZSgpO1xyXG5cclxuICAgICAgICAgICAgLy8gTGlzdGVuIGZvciBuZXcgY29ubmVjdGlvbnMuXHJcbiAgICAgICAgICAgIHBsdW1iZXIuYmluZCgnY29ubmVjdGlvbicsIGZ1bmN0aW9uIChjb25uSW5mbywgb3JpZ2luYWxFdmVudCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY29ubmVjdGlvbjogQ29ubmVjdGlvbiA9IGNvbm5JbmZvLmNvbm5lY3Rpb247XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvdXRjb21lOiBXb3JrZmxvd3MuT3V0Y29tZSA9IGNvbm5lY3Rpb24uZ2V0UGFyYW1ldGVycygpLm91dGNvbWU7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgbGFiZWw6IGFueSA9IGNvbm5lY3Rpb24uZ2V0T3ZlcmxheSgnbGFiZWwnKTtcclxuICAgICAgICAgICAgICAgIGxhYmVsLnNldExhYmVsKG91dGNvbWUuZGlzcGxheU5hbWUpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGxldCBhY3Rpdml0eUVsZW1lbnRzID0gdGhpcy5nZXRBY3Rpdml0eUVsZW1lbnRzKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgYXJlRXF1YWxPdXRjb21lcyA9IGZ1bmN0aW9uIChvdXRjb21lczE6IFdvcmtmbG93cy5PdXRjb21lW10sIG91dGNvbWVzMjogV29ya2Zsb3dzLk91dGNvbWVbXSk6IGJvb2xlYW4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKG91dGNvbWVzMS5sZW5ndGggIT0gb3V0Y29tZXMyLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG91dGNvbWVzMS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG91dGNvbWUxID0gb3V0Y29tZXMxW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG91dGNvbWUyID0gb3V0Y29tZXMyW2ldO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3V0Y29tZTEubmFtZSAhPSBvdXRjb21lMi5kaXNwbGF5TmFtZSB8fCBvdXRjb21lMS5kaXNwbGF5TmFtZSAhPSBvdXRjb21lMi5kaXNwbGF5TmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBTdXNwZW5kIGRyYXdpbmcgYW5kIGluaXRpYWxpemUuXHJcbiAgICAgICAgICAgIHBsdW1iZXIuYmF0Y2goKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlcnZlcndvcmtmbG93VHlwZTogV29ya2Zsb3dzLldvcmtmbG93VHlwZSA9IHRoaXMud29ya2Zsb3dUeXBlO1xyXG4gICAgICAgICAgICAgICAgdmFyIHdvcmtmbG93SWQ6IG51bWJlciA9IHRoaXMud29ya2Zsb3dUeXBlLmlkO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChsb2FkTG9jYWxTdGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvY2FsU3RhdGU6IFdvcmtmbG93cy5Xb3JrZmxvd1R5cGUgPSB0aGlzLmxvYWRMb2NhbFN0YXRlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChsb2NhbFN0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMud29ya2Zsb3dUeXBlID0gbG9jYWxTdGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cy5lYWNoKChpbmRleCwgYWN0aXZpdHlFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgJGFjdGl2aXR5RWxlbWVudCA9ICQoYWN0aXZpdHlFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gJGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS1pZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzRGVsZXRlZCA9IHRoaXMud29ya2Zsb3dUeXBlLnJlbW92ZWRBY3Rpdml0aWVzLmluZGV4T2YoYWN0aXZpdHlJZCkgPiAtMTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzRGVsZXRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkYWN0aXZpdHlFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBsZXQgYWN0aXZpdHkgPSB0aGlzLmdldEFjdGl2aXR5KGFjdGl2aXR5SWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlcnZlckFjdGl2aXR5ID0gdGhpcy5nZXRBY3Rpdml0eShhY3Rpdml0eUlkLCBzZXJ2ZXJ3b3JrZmxvd1R5cGUuYWN0aXZpdGllcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgYWN0aXZpdHkncyB2aXN1YWwgc3RhdGUuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWRMb2NhbFN0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3Rpdml0eSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGEgbmV3bHkgYWRkZWQgYWN0aXZpdHkgbm90IHlldCBhZGRlZCB0byBsb2NhbCBzdGF0ZS5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5ID0gc2VydmVyQWN0aXZpdHk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLndvcmtmbG93VHlwZS5hY3Rpdml0aWVzLnB1c2goYWN0aXZpdHkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5LnggPSA1MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5LnkgPSA1MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBhdmFpbGFibGUgb3V0Y29tZXMgbWlnaHQgaGF2ZSBjaGFuZ2VkIHdoZW4gZWRpdGluZyBhbiBhY3Rpdml0eSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNvIHdlIG5lZWQgdG8gY2hlY2sgZm9yIHRoYXQgYW5kIHVwZGF0ZSB0aGUgY2xpZW50J3MgYWN0aXZpdHkgb3V0Y29tZXMgaWYgc28uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzYW1lT3V0Y29tZXMgPSBhcmVFcXVhbE91dGNvbWVzKGFjdGl2aXR5Lm91dGNvbWVzLCBzZXJ2ZXJBY3Rpdml0eS5vdXRjb21lcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzYW1lT3V0Y29tZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eS5vdXRjb21lcyA9IHNlcnZlckFjdGl2aXR5Lm91dGNvbWVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpdml0eUVsZW1lbnRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY3NzKHsgbGVmdDogYWN0aXZpdHkueCwgdG9wOiBhY3Rpdml0eS55IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRvZ2dsZUNsYXNzKCdhY3Rpdml0eS1zdGFydCcsIGFjdGl2aXR5LmlzU3RhcnQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoJ2FjdGl2aXR5LXN0YXJ0JywgYWN0aXZpdHkuaXNTdGFydCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIE1ha2UgdGhlIGFjdGl2aXR5IGRyYWdnYWJsZS5cclxuICAgICAgICAgICAgICAgICAgICBwbHVtYmVyLmRyYWdnYWJsZShhY3Rpdml0eUVsZW1lbnQsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZDogWzEwLCAxMF0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5tZW50OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogKGFyZ3M6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmFnU3RhcnQgPSB7IGxlZnQ6IGFyZ3MuZS5zY3JlZW5YLCB0b3A6IGFyZ3MuZS5zY3JlZW5ZIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3A6IChhcmdzOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzRHJhZ2dlZCA9IHRoaXMuZHJhZ1N0YXJ0LmxlZnQgIT0gYXJncy5lLnNjcmVlblggfHwgdGhpcy5kcmFnU3RhcnQudG9wICE9IGFyZ3MuZS5zY3JlZW5ZO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVDYW52YXNIZWlnaHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBDb25maWd1cmUgdGhlIGFjdGl2aXR5IGFzIGEgdGFyZ2V0LlxyXG4gICAgICAgICAgICAgICAgICAgIHBsdW1iZXIubWFrZVRhcmdldChhY3Rpdml0eUVsZW1lbnQsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZHJvcE9wdGlvbnM6IHsgaG92ZXJDbGFzczogJ2hvdmVyJyB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmNob3I6ICdDb250aW51b3VzJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6IFsnQmxhbmsnLCB7IHJhZGl1czogOCB9XVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBBZGQgc291cmNlIGVuZHBvaW50cy5cclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBvdXRjb21lIG9mIGFjdGl2aXR5Lm91dGNvbWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZUVuZHBvaW50T3B0aW9ucyA9IHRoaXMuZ2V0U291cmNlRW5kcG9pbnRPcHRpb25zKGFjdGl2aXR5LCBvdXRjb21lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGx1bWJlci5hZGRFbmRwb2ludChhY3Rpdml0eUVsZW1lbnQsIHsgY29ubmVjdG9yT3ZlcmxheXM6IFtbJ0xhYmVsJywgeyBsYWJlbDogb3V0Y29tZS5kaXNwbGF5TmFtZSwgY3NzQ2xhc3M6ICdjb25uZWN0aW9uLWxhYmVsJyB9XV0gfSwgc291cmNlRW5kcG9pbnRPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBDb25uZWN0IGFjdGl2aXRpZXMuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNvbm5lY3Rpb25zKHBsdW1iZXIpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJlLXF1ZXJ5IHRoZSBhY3Rpdml0eSBlbGVtZW50cy5cclxuICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudHMgPSB0aGlzLmdldEFjdGl2aXR5RWxlbWVudHMoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBNYWtlIGFsbCBhY3Rpdml0eSBlbGVtZW50cyB2aXNpYmxlLlxyXG4gICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cy5zaG93KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVDYW52YXNIZWlnaHQoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBJbml0aWFsaXplIHBvcG92ZXJzLlxyXG4gICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzLnBvcG92ZXIoe1xyXG4gICAgICAgICAgICAgICAgdHJpZ2dlcjogJ21hbnVhbCcsXHJcbiAgICAgICAgICAgICAgICBodG1sOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgY29udGVudDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2aXR5RWxlbWVudCA9ICQodGhpcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgJGNvbnRlbnQ6IEpRdWVyeTxFbGVtZW50PiA9IGFjdGl2aXR5RWxlbWVudC5maW5kKCcuYWN0aXZpdHktY29tbWFuZHMnKS5jbG9uZSgpLnNob3coKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFydEJ1dHRvbiA9ICRjb250ZW50LmZpbmQoJy5hY3Rpdml0eS1zdGFydC1hY3Rpb24nKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpc1N0YXJ0ID0gYWN0aXZpdHlFbGVtZW50LmRhdGEoJ2FjdGl2aXR5LXN0YXJ0JykgPT09IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWN0aXZpdHlJZDogbnVtYmVyID0gYWN0aXZpdHlFbGVtZW50LmRhdGEoJ2FjdGl2aXR5LWlkJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0QnV0dG9uLmF0dHIoJ2FyaWEtcHJlc3NlZCcsIGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS1zdGFydCcpKTtcclxuICAgICAgICAgICAgICAgICAgICBzdGFydEJ1dHRvbi50b2dnbGVDbGFzcygnYWN0aXZlJywgaXNTdGFydCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRjb250ZW50Lm9uKCdjbGljaycsICcuYWN0aXZpdHktc3RhcnQtYWN0aW9uJywgZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYnV0dG9uID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNTdGFydCA9IGJ1dHRvbi5pcygnLmFjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktc3RhcnQnLCBpc1N0YXJ0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50LnRvZ2dsZUNsYXNzKCdhY3Rpdml0eS1zdGFydCcsIGlzU3RhcnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkY29udGVudC5vbignY2xpY2snLCAnLmFjdGl2aXR5LWRlbGV0ZS1hY3Rpb24nLCBlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogVGhlIHByb21wdHMgYXJlIHJlYWxseSBhbm5veWluZy4gQ29uc2lkZXIgc2hvd2luZyBzb21lIHNvcnQgb2Ygc21hbGwgbWVzc2FnZSBiYWxsb29uIHNvbWV3aGVyZSB0byB1bmRvIHRoZSBhY3Rpb24gaW5zdGVhZC5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiAoIWNvbmZpcm0oc2VsZi5kZWxldGVBY3Rpdml0eVByb21wdCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL31cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYud29ya2Zsb3dUeXBlLnJlbW92ZWRBY3Rpdml0aWVzLnB1c2goYWN0aXZpdHlJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsdW1iZXIucmVtb3ZlKGFjdGl2aXR5RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudC5wb3BvdmVyKCdkaXNwb3NlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRjb250ZW50Lm9uKCdjbGljaycsICdbZGF0YS1wZXJzaXN0LXdvcmtmbG93XScsIGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhdmVMb2NhbFN0YXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkY29udGVudC5nZXQoMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJChjb250YWluZXIpLm9uKCdjbGljaycsICcuYWN0aXZpdHknLCBlID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc0RyYWdnZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhc0RyYWdnZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gaWYgYW55IG90aGVyIHBvcG92ZXJzIGFyZSB2aXNpYmxlLCBoaWRlIHRoZW1cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzUG9wb3ZlclZpc2libGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzLnBvcG92ZXIoJ2hpZGUnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBzZW5kZXIgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICAgICAgICAgICAgICBzZW5kZXIucG9wb3Zlcignc2hvdycpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIGhhbmRsZSBjbGlja2luZyBvbiB0aGUgcG9wb3ZlciBpdHNlbGYuXHJcbiAgICAgICAgICAgICAgICAkKCcucG9wb3ZlcicpLm9mZignY2xpY2snKS5vbignY2xpY2snLCBlMiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZTIuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzUG9wb3ZlclZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICQoY29udGFpbmVyKS5vbignZGJsY2xpY2snLCAnLmFjdGl2aXR5JywgZSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzZW5kZXIgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBoYXNFZGl0b3IgPSBzZW5kZXIuZGF0YSgnYWN0aXZpdHktaGFzLWVkaXRvcicpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChoYXNFZGl0b3IpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmVMb2NhbFN0YXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VuZGVyLmZpbmQoJy5hY3Rpdml0eS1lZGl0LWFjdGlvbicpLmdldCgwKS5jbGljaygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIEhpZGUgYWxsIHBvcG92ZXJzIHdoZW4gY2xpY2tpbmcgYW55d2hlcmUgYnV0IG9uIGFuIGFjdGl2aXR5LlxyXG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgZSA9PiB7XHJcbiAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzLnBvcG92ZXIoJ2hpZGUnKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNQb3BvdmVyVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIFNhdmUgbG9jYWwgY2hhbmdlcyBpZiB0aGUgZXZlbnQgdGFyZ2V0IGhhcyB0aGUgJ2RhdGEtcGVyc2lzdC13b3JrZmxvdycgYXR0cmlidXRlLlxyXG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgJ1tkYXRhLXBlcnNpc3Qtd29ya2Zsb3ddJywgZSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNhdmVMb2NhbFN0YXRlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5qc1BsdW1iSW5zdGFuY2UgPSBwbHVtYmVyO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0U3RhdGUgPSAoKTogV29ya2Zsb3dzLldvcmtmbG93VHlwZSA9PiB7XHJcbiAgICAgICAgY29uc3QgJGFsbEFjdGl2aXR5RWxlbWVudHMgPSAkKHRoaXMuY29udGFpbmVyKS5maW5kKCcuYWN0aXZpdHknKTtcclxuICAgICAgICBjb25zdCB3b3JrZmxvdzogV29ya2Zsb3dzLldvcmtmbG93VHlwZSA9IHtcclxuICAgICAgICAgICAgaWQ6IHRoaXMud29ya2Zsb3dUeXBlLmlkLFxyXG4gICAgICAgICAgICBhY3Rpdml0aWVzOiBbXSxcclxuICAgICAgICAgICAgdHJhbnNpdGlvbnM6IFtdLFxyXG4gICAgICAgICAgICByZW1vdmVkQWN0aXZpdGllczogdGhpcy53b3JrZmxvd1R5cGUucmVtb3ZlZEFjdGl2aXRpZXNcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBDb2xsZWN0IGFjdGl2aXRpZXMuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAkYWxsQWN0aXZpdHlFbGVtZW50cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCAkYWN0aXZpdHlFbGVtZW50OiBKUXVlcnkgPSAkKCRhbGxBY3Rpdml0eUVsZW1lbnRzW2ldKTtcclxuICAgICAgICAgICAgY29uc3QgYWN0aXZpdHlJZDogc3RyaW5nID0gJGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS1pZCcpO1xyXG4gICAgICAgICAgICBjb25zdCBhY3Rpdml0eUlzU3RhcnQ6IGJvb2xlYW4gPSAkYWN0aXZpdHlFbGVtZW50LmRhdGEoJ2FjdGl2aXR5LXN0YXJ0Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IGFjdGl2aXR5SXNFdmVudDogYm9vbGVhbiA9ICRhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktdHlwZScpID09PSAnRXZlbnQnO1xyXG4gICAgICAgICAgICBjb25zdCBhY3Rpdml0eVBvc2l0aW9uOiBKUXVlcnkuQ29vcmRpbmF0ZXMgPSAkYWN0aXZpdHlFbGVtZW50LnBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGFjdGl2aXR5OiBXb3JrZmxvd3MuQWN0aXZpdHkgPSB0aGlzLmdldEFjdGl2aXR5KGFjdGl2aXR5SWQpO1xyXG5cclxuICAgICAgICAgICAgd29ya2Zsb3cuYWN0aXZpdGllcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgIGlkOiBhY3Rpdml0eUlkLFxyXG4gICAgICAgICAgICAgICAgaXNTdGFydDogYWN0aXZpdHlJc1N0YXJ0LFxyXG4gICAgICAgICAgICAgICAgaXNFdmVudDogYWN0aXZpdHlJc0V2ZW50LFxyXG4gICAgICAgICAgICAgICAgb3V0Y29tZXM6IGFjdGl2aXR5Lm91dGNvbWVzLFxyXG4gICAgICAgICAgICAgICAgeDogYWN0aXZpdHlQb3NpdGlvbi5sZWZ0LFxyXG4gICAgICAgICAgICAgICAgeTogYWN0aXZpdHlQb3NpdGlvbi50b3BcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDb2xsZWN0IGNvbm5lY3Rpb25zLlxyXG4gICAgICAgIGNvbnN0IGFsbENvbm5lY3Rpb25zID0gdGhpcy5qc1BsdW1iSW5zdGFuY2UuZ2V0Q29ubmVjdGlvbnMoKTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhbGxDb25uZWN0aW9ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgY29ubmVjdGlvbiA9IGFsbENvbm5lY3Rpb25zW2ldO1xyXG4gICAgICAgICAgICB2YXIgc291cmNlRW5kcG9pbnQ6IEVuZHBvaW50ID0gY29ubmVjdGlvbi5lbmRwb2ludHNbMF07XHJcbiAgICAgICAgICAgIHZhciBzb3VyY2VPdXRjb21lTmFtZSA9IHNvdXJjZUVuZHBvaW50LmdldFBhcmFtZXRlcnMoKS5vdXRjb21lLm5hbWU7XHJcbiAgICAgICAgICAgIHZhciBzb3VyY2VBY3Rpdml0eUlkOiBzdHJpbmcgPSAkKGNvbm5lY3Rpb24uc291cmNlKS5kYXRhKCdhY3Rpdml0eS1pZCcpO1xyXG4gICAgICAgICAgICB2YXIgZGVzdGluYXRpb25BY3Rpdml0eUlkOiBzdHJpbmcgPSAkKGNvbm5lY3Rpb24udGFyZ2V0KS5kYXRhKCdhY3Rpdml0eS1pZCcpO1xyXG5cclxuICAgICAgICAgICAgd29ya2Zsb3cudHJhbnNpdGlvbnMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICBzb3VyY2VBY3Rpdml0eUlkOiBzb3VyY2VBY3Rpdml0eUlkLFxyXG4gICAgICAgICAgICAgICAgZGVzdGluYXRpb25BY3Rpdml0eUlkOiBkZXN0aW5hdGlvbkFjdGl2aXR5SWQsXHJcbiAgICAgICAgICAgICAgICBzb3VyY2VPdXRjb21lTmFtZTogc291cmNlT3V0Y29tZU5hbWVcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gd29ya2Zsb3c7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNlcmlhbGl6ZSA9ICgpOiBzdHJpbmcgPT4ge1xyXG4gICAgICAgIGNvbnN0IHdvcmtmbG93OiBXb3JrZmxvd3MuV29ya2Zsb3dUeXBlID0gdGhpcy5nZXRTdGF0ZSgpO1xyXG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh3b3JrZmxvdyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzYXZlTG9jYWxTdGF0ZSA9ICgpOiB2b2lkID0+IHtcclxuICAgICAgICBzZXNzaW9uU3RvcmFnZVt0aGlzLmxvY2FsSWRdID0gdGhpcy5zZXJpYWxpemUoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGxvYWRMb2NhbFN0YXRlID0gKCk6IFdvcmtmbG93cy5Xb3JrZmxvd1R5cGUgPT4ge1xyXG4gICAgICAgIHJldHVybiBKU09OLnBhcnNlKHNlc3Npb25TdG9yYWdlW3RoaXMubG9jYWxJZF0pO1xyXG4gICAgfVxyXG59XHJcblxyXG4kLmZuLndvcmtmbG93RWRpdG9yID0gZnVuY3Rpb24gKHRoaXM6IEpRdWVyeSk6IEpRdWVyeSB7XHJcbiAgICB0aGlzLmVhY2goKGluZGV4LCBlbGVtZW50KSA9PiB7XHJcbiAgICAgICAgdmFyICRlbGVtZW50ID0gJChlbGVtZW50KTtcclxuICAgICAgICB2YXIgd29ya2Zsb3dUeXBlOiBXb3JrZmxvd3MuV29ya2Zsb3dUeXBlID0gJGVsZW1lbnQuZGF0YSgnd29ya2Zsb3ctdHlwZScpO1xyXG4gICAgICAgIHZhciBkZWxldGVBY3Rpdml0eVByb21wdDogc3RyaW5nID0gJGVsZW1lbnQuZGF0YSgnd29ya2Zsb3ctZGVsZXRlLWFjdGl2aXR5LXByb21wdCcpO1xyXG4gICAgICAgIHZhciBsb2NhbElkOiBzdHJpbmcgPSAkZWxlbWVudC5kYXRhKCd3b3JrZmxvdy1sb2NhbC1pZCcpO1xyXG4gICAgICAgIHZhciBsb2FkTG9jYWxTdGF0ZTogYm9vbGVhbiA9ICRlbGVtZW50LmRhdGEoJ3dvcmtmbG93LWxvYWQtbG9jYWwtc3RhdGUnKTtcclxuXHJcbiAgICAgICAgd29ya2Zsb3dUeXBlLnJlbW92ZWRBY3Rpdml0aWVzID0gd29ya2Zsb3dUeXBlLnJlbW92ZWRBY3Rpdml0aWVzIHx8IFtdO1xyXG4gICAgICAgICRlbGVtZW50LmRhdGEoJ3dvcmtmbG93RWRpdG9yJywgbmV3IFdvcmtmbG93RWRpdG9yKGVsZW1lbnQsIHdvcmtmbG93VHlwZSwgZGVsZXRlQWN0aXZpdHlQcm9tcHQsIGxvY2FsSWQsIGxvYWRMb2NhbFN0YXRlKSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gdGhpcztcclxufTtcclxuXHJcbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnN0IHdvcmtmbG93RWRpdG9yOiBXb3JrZmxvd0VkaXRvciA9ICQoJy53b3JrZmxvdy1jYW52YXMnKS53b3JrZmxvd0VkaXRvcigpLmRhdGEoJ3dvcmtmbG93RWRpdG9yJyk7XHJcblxyXG4gICAgJCgnI3dvcmtmbG93RWRpdG9yRm9ybScpLm9uKCdzdWJtaXQnLCAocywgZSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHN0YXRlID0gd29ya2Zsb3dFZGl0b3Iuc2VyaWFsaXplKCk7XHJcbiAgICAgICAgJCgnI3dvcmtmbG93U3RhdGVJbnB1dCcpLnZhbChzdGF0ZSk7XHJcbiAgICB9KTtcclxufSk7XHJcbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pxdWVyeS90eXBpbmdzLmQudHMnIC8+XG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qc3BsdW1iL3R5cGluZ3MuZC50cycgLz5cbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi93b3JrZmxvdy1tb2RlbHMudHMnIC8+XG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4vd29ya2Zsb3ctY2FudmFzLnRzJyAvPlxudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDbGFzcyBleHRlbmRzIHZhbHVlIFwiICsgU3RyaW5nKGIpICsgXCIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbFwiKTtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbi8vIFRPRE86IFJlLWltcGxlbWVudCB0aGlzIHVzaW5nIGEgTVZWTSBhcHByb2FjaC5cbnZhciBXb3JrZmxvd0VkaXRvciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoV29ya2Zsb3dFZGl0b3IsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gV29ya2Zsb3dFZGl0b3IoY29udGFpbmVyLCB3b3JrZmxvd1R5cGUsIGRlbGV0ZUFjdGl2aXR5UHJvbXB0LCBsb2NhbElkLCBsb2FkTG9jYWxTdGF0ZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBjb250YWluZXIsIHdvcmtmbG93VHlwZSkgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xuICAgICAgICBfdGhpcy53b3JrZmxvd1R5cGUgPSB3b3JrZmxvd1R5cGU7XG4gICAgICAgIF90aGlzLmRlbGV0ZUFjdGl2aXR5UHJvbXB0ID0gZGVsZXRlQWN0aXZpdHlQcm9tcHQ7XG4gICAgICAgIF90aGlzLmxvY2FsSWQgPSBsb2NhbElkO1xuICAgICAgICBfdGhpcy5nZXRTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciAkYWxsQWN0aXZpdHlFbGVtZW50cyA9ICQoX3RoaXMuY29udGFpbmVyKS5maW5kKCcuYWN0aXZpdHknKTtcbiAgICAgICAgICAgIHZhciB3b3JrZmxvdyA9IHtcbiAgICAgICAgICAgICAgICBpZDogX3RoaXMud29ya2Zsb3dUeXBlLmlkLFxuICAgICAgICAgICAgICAgIGFjdGl2aXRpZXM6IFtdLFxuICAgICAgICAgICAgICAgIHRyYW5zaXRpb25zOiBbXSxcbiAgICAgICAgICAgICAgICByZW1vdmVkQWN0aXZpdGllczogX3RoaXMud29ya2Zsb3dUeXBlLnJlbW92ZWRBY3Rpdml0aWVzXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgLy8gQ29sbGVjdCBhY3Rpdml0aWVzLlxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkYWxsQWN0aXZpdHlFbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciAkYWN0aXZpdHlFbGVtZW50ID0gJCgkYWxsQWN0aXZpdHlFbGVtZW50c1tpXSk7XG4gICAgICAgICAgICAgICAgdmFyIGFjdGl2aXR5SWQgPSAkYWN0aXZpdHlFbGVtZW50LmRhdGEoJ2FjdGl2aXR5LWlkJyk7XG4gICAgICAgICAgICAgICAgdmFyIGFjdGl2aXR5SXNTdGFydCA9ICRhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktc3RhcnQnKTtcbiAgICAgICAgICAgICAgICB2YXIgYWN0aXZpdHlJc0V2ZW50ID0gJGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS10eXBlJykgPT09ICdFdmVudCc7XG4gICAgICAgICAgICAgICAgdmFyIGFjdGl2aXR5UG9zaXRpb24gPSAkYWN0aXZpdHlFbGVtZW50LnBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgdmFyIGFjdGl2aXR5ID0gX3RoaXMuZ2V0QWN0aXZpdHkoYWN0aXZpdHlJZCk7XG4gICAgICAgICAgICAgICAgd29ya2Zsb3cuYWN0aXZpdGllcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGFjdGl2aXR5SWQsXG4gICAgICAgICAgICAgICAgICAgIGlzU3RhcnQ6IGFjdGl2aXR5SXNTdGFydCxcbiAgICAgICAgICAgICAgICAgICAgaXNFdmVudDogYWN0aXZpdHlJc0V2ZW50LFxuICAgICAgICAgICAgICAgICAgICBvdXRjb21lczogYWN0aXZpdHkub3V0Y29tZXMsXG4gICAgICAgICAgICAgICAgICAgIHg6IGFjdGl2aXR5UG9zaXRpb24ubGVmdCxcbiAgICAgICAgICAgICAgICAgICAgeTogYWN0aXZpdHlQb3NpdGlvbi50b3BcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIENvbGxlY3QgY29ubmVjdGlvbnMuXG4gICAgICAgICAgICB2YXIgYWxsQ29ubmVjdGlvbnMgPSBfdGhpcy5qc1BsdW1iSW5zdGFuY2UuZ2V0Q29ubmVjdGlvbnMoKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYWxsQ29ubmVjdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgY29ubmVjdGlvbiA9IGFsbENvbm5lY3Rpb25zW2ldO1xuICAgICAgICAgICAgICAgIHZhciBzb3VyY2VFbmRwb2ludCA9IGNvbm5lY3Rpb24uZW5kcG9pbnRzWzBdO1xuICAgICAgICAgICAgICAgIHZhciBzb3VyY2VPdXRjb21lTmFtZSA9IHNvdXJjZUVuZHBvaW50LmdldFBhcmFtZXRlcnMoKS5vdXRjb21lLm5hbWU7XG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZUFjdGl2aXR5SWQgPSAkKGNvbm5lY3Rpb24uc291cmNlKS5kYXRhKCdhY3Rpdml0eS1pZCcpO1xuICAgICAgICAgICAgICAgIHZhciBkZXN0aW5hdGlvbkFjdGl2aXR5SWQgPSAkKGNvbm5lY3Rpb24udGFyZ2V0KS5kYXRhKCdhY3Rpdml0eS1pZCcpO1xuICAgICAgICAgICAgICAgIHdvcmtmbG93LnRyYW5zaXRpb25zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzb3VyY2VBY3Rpdml0eUlkOiBzb3VyY2VBY3Rpdml0eUlkLFxuICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbkFjdGl2aXR5SWQ6IGRlc3RpbmF0aW9uQWN0aXZpdHlJZCxcbiAgICAgICAgICAgICAgICAgICAgc291cmNlT3V0Y29tZU5hbWU6IHNvdXJjZU91dGNvbWVOYW1lXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gd29ya2Zsb3c7XG4gICAgICAgIH07XG4gICAgICAgIF90aGlzLnNlcmlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB3b3JrZmxvdyA9IF90aGlzLmdldFN0YXRlKCk7XG4gICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkod29ya2Zsb3cpO1xuICAgICAgICB9O1xuICAgICAgICBfdGhpcy5zYXZlTG9jYWxTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlW190aGlzLmxvY2FsSWRdID0gX3RoaXMuc2VyaWFsaXplKCk7XG4gICAgICAgIH07XG4gICAgICAgIF90aGlzLmxvYWRMb2NhbFN0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2Uoc2Vzc2lvblN0b3JhZ2VbX3RoaXMubG9jYWxJZF0pO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgc2VsZiA9IF90aGlzO1xuICAgICAgICBqc1BsdW1iLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGpzUGx1bWIuaW1wb3J0RGVmYXVsdHMoX3RoaXMuZ2V0RGVmYXVsdHMoKSk7XG4gICAgICAgICAgICB2YXIgcGx1bWJlciA9IF90aGlzLmNyZWF0ZUpzUGx1bWJJbnN0YW5jZSgpO1xuICAgICAgICAgICAgLy8gTGlzdGVuIGZvciBuZXcgY29ubmVjdGlvbnMuXG4gICAgICAgICAgICBwbHVtYmVyLmJpbmQoJ2Nvbm5lY3Rpb24nLCBmdW5jdGlvbiAoY29ubkluZm8sIG9yaWdpbmFsRXZlbnQpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29ubmVjdGlvbiA9IGNvbm5JbmZvLmNvbm5lY3Rpb247XG4gICAgICAgICAgICAgICAgdmFyIG91dGNvbWUgPSBjb25uZWN0aW9uLmdldFBhcmFtZXRlcnMoKS5vdXRjb21lO1xuICAgICAgICAgICAgICAgIHZhciBsYWJlbCA9IGNvbm5lY3Rpb24uZ2V0T3ZlcmxheSgnbGFiZWwnKTtcbiAgICAgICAgICAgICAgICBsYWJlbC5zZXRMYWJlbChvdXRjb21lLmRpc3BsYXlOYW1lKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIGFjdGl2aXR5RWxlbWVudHMgPSBfdGhpcy5nZXRBY3Rpdml0eUVsZW1lbnRzKCk7XG4gICAgICAgICAgICB2YXIgYXJlRXF1YWxPdXRjb21lcyA9IGZ1bmN0aW9uIChvdXRjb21lczEsIG91dGNvbWVzMikge1xuICAgICAgICAgICAgICAgIGlmIChvdXRjb21lczEubGVuZ3RoICE9IG91dGNvbWVzMi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG91dGNvbWVzMS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgb3V0Y29tZTEgPSBvdXRjb21lczFbaV07XG4gICAgICAgICAgICAgICAgICAgIHZhciBvdXRjb21lMiA9IG91dGNvbWVzMltpXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG91dGNvbWUxLm5hbWUgIT0gb3V0Y29tZTIuZGlzcGxheU5hbWUgfHwgb3V0Y29tZTEuZGlzcGxheU5hbWUgIT0gb3V0Y29tZTIuZGlzcGxheU5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAvLyBTdXNwZW5kIGRyYXdpbmcgYW5kIGluaXRpYWxpemUuXG4gICAgICAgICAgICBwbHVtYmVyLmJhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VydmVyd29ya2Zsb3dUeXBlID0gX3RoaXMud29ya2Zsb3dUeXBlO1xuICAgICAgICAgICAgICAgIHZhciB3b3JrZmxvd0lkID0gX3RoaXMud29ya2Zsb3dUeXBlLmlkO1xuICAgICAgICAgICAgICAgIGlmIChsb2FkTG9jYWxTdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbG9jYWxTdGF0ZSA9IF90aGlzLmxvYWRMb2NhbFN0YXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsb2NhbFN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy53b3JrZmxvd1R5cGUgPSBsb2NhbFN0YXRlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudHMuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGFjdGl2aXR5RWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgJGFjdGl2aXR5RWxlbWVudCA9ICQoYWN0aXZpdHlFbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGl2aXR5SWQgPSAkYWN0aXZpdHlFbGVtZW50LmRhdGEoJ2FjdGl2aXR5LWlkJyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpc0RlbGV0ZWQgPSBfdGhpcy53b3JrZmxvd1R5cGUucmVtb3ZlZEFjdGl2aXRpZXMuaW5kZXhPZihhY3Rpdml0eUlkKSA+IC0xO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNEZWxldGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkYWN0aXZpdHlFbGVtZW50LnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpdml0eSA9IF90aGlzLmdldEFjdGl2aXR5KGFjdGl2aXR5SWQpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2VydmVyQWN0aXZpdHkgPSBfdGhpcy5nZXRBY3Rpdml0eShhY3Rpdml0eUlkLCBzZXJ2ZXJ3b3JrZmxvd1R5cGUuYWN0aXZpdGllcyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgYWN0aXZpdHkncyB2aXN1YWwgc3RhdGUuXG4gICAgICAgICAgICAgICAgICAgIGlmIChsb2FkTG9jYWxTdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGl2aXR5ID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGEgbmV3bHkgYWRkZWQgYWN0aXZpdHkgbm90IHlldCBhZGRlZCB0byBsb2NhbCBzdGF0ZS5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eSA9IHNlcnZlckFjdGl2aXR5O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLndvcmtmbG93VHlwZS5hY3Rpdml0aWVzLnB1c2goYWN0aXZpdHkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5LnggPSA1MDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eS55ID0gNTA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgYXZhaWxhYmxlIG91dGNvbWVzIG1pZ2h0IGhhdmUgY2hhbmdlZCB3aGVuIGVkaXRpbmcgYW4gYWN0aXZpdHksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc28gd2UgbmVlZCB0byBjaGVjayBmb3IgdGhhdCBhbmQgdXBkYXRlIHRoZSBjbGllbnQncyBhY3Rpdml0eSBvdXRjb21lcyBpZiBzby5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2FtZU91dGNvbWVzID0gYXJlRXF1YWxPdXRjb21lcyhhY3Rpdml0eS5vdXRjb21lcywgc2VydmVyQWN0aXZpdHkub3V0Y29tZXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc2FtZU91dGNvbWVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5Lm91dGNvbWVzID0gc2VydmVyQWN0aXZpdHkub3V0Y29tZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpdml0eUVsZW1lbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNzcyh7IGxlZnQ6IGFjdGl2aXR5LngsIHRvcDogYWN0aXZpdHkueSB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudG9nZ2xlQ2xhc3MoJ2FjdGl2aXR5LXN0YXJ0JywgYWN0aXZpdHkuaXNTdGFydClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoJ2FjdGl2aXR5LXN0YXJ0JywgYWN0aXZpdHkuaXNTdGFydCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gTWFrZSB0aGUgYWN0aXZpdHkgZHJhZ2dhYmxlLlxuICAgICAgICAgICAgICAgICAgICBwbHVtYmVyLmRyYWdnYWJsZShhY3Rpdml0eUVsZW1lbnQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWQ6IFsxMCwgMTBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbm1lbnQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5kcmFnU3RhcnQgPSB7IGxlZnQ6IGFyZ3MuZS5zY3JlZW5YLCB0b3A6IGFyZ3MuZS5zY3JlZW5ZIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RvcDogZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5oYXNEcmFnZ2VkID0gX3RoaXMuZHJhZ1N0YXJ0LmxlZnQgIT0gYXJncy5lLnNjcmVlblggfHwgX3RoaXMuZHJhZ1N0YXJ0LnRvcCAhPSBhcmdzLmUuc2NyZWVuWTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy51cGRhdGVDYW52YXNIZWlnaHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIENvbmZpZ3VyZSB0aGUgYWN0aXZpdHkgYXMgYSB0YXJnZXQuXG4gICAgICAgICAgICAgICAgICAgIHBsdW1iZXIubWFrZVRhcmdldChhY3Rpdml0eUVsZW1lbnQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BPcHRpb25zOiB7IGhvdmVyQ2xhc3M6ICdob3ZlcicgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvcjogJ0NvbnRpbnVvdXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6IFsnQmxhbmsnLCB7IHJhZGl1czogOCB9XVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHNvdXJjZSBlbmRwb2ludHMuXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBhY3Rpdml0eS5vdXRjb21lczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvdXRjb21lID0gX2FbX2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNvdXJjZUVuZHBvaW50T3B0aW9ucyA9IF90aGlzLmdldFNvdXJjZUVuZHBvaW50T3B0aW9ucyhhY3Rpdml0eSwgb3V0Y29tZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwbHVtYmVyLmFkZEVuZHBvaW50KGFjdGl2aXR5RWxlbWVudCwgeyBjb25uZWN0b3JPdmVybGF5czogW1snTGFiZWwnLCB7IGxhYmVsOiBvdXRjb21lLmRpc3BsYXlOYW1lLCBjc3NDbGFzczogJ2Nvbm5lY3Rpb24tbGFiZWwnIH1dXSB9LCBzb3VyY2VFbmRwb2ludE9wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gQ29ubmVjdCBhY3Rpdml0aWVzLlxuICAgICAgICAgICAgICAgIF90aGlzLnVwZGF0ZUNvbm5lY3Rpb25zKHBsdW1iZXIpO1xuICAgICAgICAgICAgICAgIC8vIFJlLXF1ZXJ5IHRoZSBhY3Rpdml0eSBlbGVtZW50cy5cbiAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzID0gX3RoaXMuZ2V0QWN0aXZpdHlFbGVtZW50cygpO1xuICAgICAgICAgICAgICAgIC8vIE1ha2UgYWxsIGFjdGl2aXR5IGVsZW1lbnRzIHZpc2libGUuXG4gICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cy5zaG93KCk7XG4gICAgICAgICAgICAgICAgX3RoaXMudXBkYXRlQ2FudmFzSGVpZ2h0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgcG9wb3ZlcnMuXG4gICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzLnBvcG92ZXIoe1xuICAgICAgICAgICAgICAgIHRyaWdnZXI6ICdtYW51YWwnLFxuICAgICAgICAgICAgICAgIGh0bWw6IHRydWUsXG4gICAgICAgICAgICAgICAgY29udGVudDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aXZpdHlFbGVtZW50ID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyICRjb250ZW50ID0gYWN0aXZpdHlFbGVtZW50LmZpbmQoJy5hY3Rpdml0eS1jb21tYW5kcycpLmNsb25lKCkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3RhcnRCdXR0b24gPSAkY29udGVudC5maW5kKCcuYWN0aXZpdHktc3RhcnQtYWN0aW9uJyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpc1N0YXJ0ID0gYWN0aXZpdHlFbGVtZW50LmRhdGEoJ2FjdGl2aXR5LXN0YXJ0JykgPT09IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpdml0eUlkID0gYWN0aXZpdHlFbGVtZW50LmRhdGEoJ2FjdGl2aXR5LWlkJyk7XG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0QnV0dG9uLmF0dHIoJ2FyaWEtcHJlc3NlZCcsIGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS1zdGFydCcpKTtcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRCdXR0b24udG9nZ2xlQ2xhc3MoJ2FjdGl2ZScsIGlzU3RhcnQpO1xuICAgICAgICAgICAgICAgICAgICAkY29udGVudC5vbignY2xpY2snLCAnLmFjdGl2aXR5LXN0YXJ0LWFjdGlvbicsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYnV0dG9uID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlzU3RhcnQgPSBidXR0b24uaXMoJy5hY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS1zdGFydCcsIGlzU3RhcnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50LnRvZ2dsZUNsYXNzKCdhY3Rpdml0eS1zdGFydCcsIGlzU3RhcnQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgJGNvbnRlbnQub24oJ2NsaWNrJywgJy5hY3Rpdml0eS1kZWxldGUtYWN0aW9uJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IFRoZSBwcm9tcHRzIGFyZSByZWFsbHkgYW5ub3lpbmcuIENvbnNpZGVyIHNob3dpbmcgc29tZSBzb3J0IG9mIHNtYWxsIG1lc3NhZ2UgYmFsbG9vbiBzb21ld2hlcmUgdG8gdW5kbyB0aGUgYWN0aW9uIGluc3RlYWQuXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2lmICghY29uZmlybShzZWxmLmRlbGV0ZUFjdGl2aXR5UHJvbXB0KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy99XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLndvcmtmbG93VHlwZS5yZW1vdmVkQWN0aXZpdGllcy5wdXNoKGFjdGl2aXR5SWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGx1bWJlci5yZW1vdmUoYWN0aXZpdHlFbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudC5wb3BvdmVyKCdkaXNwb3NlJyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAkY29udGVudC5vbignY2xpY2snLCAnW2RhdGEtcGVyc2lzdC13b3JrZmxvd10nLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYXZlTG9jYWxTdGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRjb250ZW50LmdldCgwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICQoY29udGFpbmVyKS5vbignY2xpY2snLCAnLmFjdGl2aXR5JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuaGFzRHJhZ2dlZCkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5oYXNEcmFnZ2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gaWYgYW55IG90aGVyIHBvcG92ZXJzIGFyZSB2aXNpYmxlLCBoaWRlIHRoZW1cbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuaXNQb3BvdmVyVmlzaWJsZSkge1xuICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzLnBvcG92ZXIoJ2hpZGUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHNlbmRlciA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICAgICAgICAgICAgICBzZW5kZXIucG9wb3Zlcignc2hvdycpO1xuICAgICAgICAgICAgICAgIC8vIGhhbmRsZSBjbGlja2luZyBvbiB0aGUgcG9wb3ZlciBpdHNlbGYuXG4gICAgICAgICAgICAgICAgJCgnLnBvcG92ZXInKS5vZmYoJ2NsaWNrJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUyKSB7XG4gICAgICAgICAgICAgICAgICAgIGUyLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgX3RoaXMuaXNQb3BvdmVyVmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICQoY29udGFpbmVyKS5vbignZGJsY2xpY2snLCAnLmFjdGl2aXR5JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VuZGVyID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgICAgICAgICAgICAgIHZhciBoYXNFZGl0b3IgPSBzZW5kZXIuZGF0YSgnYWN0aXZpdHktaGFzLWVkaXRvcicpO1xuICAgICAgICAgICAgICAgIGlmIChoYXNFZGl0b3IpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2F2ZUxvY2FsU3RhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgc2VuZGVyLmZpbmQoJy5hY3Rpdml0eS1lZGl0LWFjdGlvbicpLmdldCgwKS5jbGljaygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gSGlkZSBhbGwgcG9wb3ZlcnMgd2hlbiBjbGlja2luZyBhbnl3aGVyZSBidXQgb24gYW4gYWN0aXZpdHkuXG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzLnBvcG92ZXIoJ2hpZGUnKTtcbiAgICAgICAgICAgICAgICBfdGhpcy5pc1BvcG92ZXJWaXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIFNhdmUgbG9jYWwgY2hhbmdlcyBpZiB0aGUgZXZlbnQgdGFyZ2V0IGhhcyB0aGUgJ2RhdGEtcGVyc2lzdC13b3JrZmxvdycgYXR0cmlidXRlLlxuICAgICAgICAgICAgJCgnYm9keScpLm9uKCdjbGljaycsICdbZGF0YS1wZXJzaXN0LXdvcmtmbG93XScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuc2F2ZUxvY2FsU3RhdGUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgX3RoaXMuanNQbHVtYkluc3RhbmNlID0gcGx1bWJlcjtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIFdvcmtmbG93RWRpdG9yO1xufShXb3JrZmxvd0NhbnZhcykpO1xuJC5mbi53b3JrZmxvd0VkaXRvciA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmVhY2goZnVuY3Rpb24gKGluZGV4LCBlbGVtZW50KSB7XG4gICAgICAgIHZhciAkZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIHZhciB3b3JrZmxvd1R5cGUgPSAkZWxlbWVudC5kYXRhKCd3b3JrZmxvdy10eXBlJyk7XG4gICAgICAgIHZhciBkZWxldGVBY3Rpdml0eVByb21wdCA9ICRlbGVtZW50LmRhdGEoJ3dvcmtmbG93LWRlbGV0ZS1hY3Rpdml0eS1wcm9tcHQnKTtcbiAgICAgICAgdmFyIGxvY2FsSWQgPSAkZWxlbWVudC5kYXRhKCd3b3JrZmxvdy1sb2NhbC1pZCcpO1xuICAgICAgICB2YXIgbG9hZExvY2FsU3RhdGUgPSAkZWxlbWVudC5kYXRhKCd3b3JrZmxvdy1sb2FkLWxvY2FsLXN0YXRlJyk7XG4gICAgICAgIHdvcmtmbG93VHlwZS5yZW1vdmVkQWN0aXZpdGllcyA9IHdvcmtmbG93VHlwZS5yZW1vdmVkQWN0aXZpdGllcyB8fCBbXTtcbiAgICAgICAgJGVsZW1lbnQuZGF0YSgnd29ya2Zsb3dFZGl0b3InLCBuZXcgV29ya2Zsb3dFZGl0b3IoZWxlbWVudCwgd29ya2Zsb3dUeXBlLCBkZWxldGVBY3Rpdml0eVByb21wdCwgbG9jYWxJZCwgbG9hZExvY2FsU3RhdGUpKTtcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcztcbn07XG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHdvcmtmbG93RWRpdG9yID0gJCgnLndvcmtmbG93LWNhbnZhcycpLndvcmtmbG93RWRpdG9yKCkuZGF0YSgnd29ya2Zsb3dFZGl0b3InKTtcbiAgICAkKCcjd29ya2Zsb3dFZGl0b3JGb3JtJykub24oJ3N1Ym1pdCcsIGZ1bmN0aW9uIChzLCBlKSB7XG4gICAgICAgIHZhciBzdGF0ZSA9IHdvcmtmbG93RWRpdG9yLnNlcmlhbGl6ZSgpO1xuICAgICAgICAkKCcjd29ya2Zsb3dTdGF0ZUlucHV0JykudmFsKHN0YXRlKTtcbiAgICB9KTtcbn0pO1xuIl19
